function trim(e){return null==e||e==undefined?e:"undefined"==typeof e.trim?e.replace(/^\s+|\s+$/gm,""):e.trim()}function getJSON(e){if("undefined"!=typeof JSON)try{return JSON.stringify(e)}catch(t){return null}}function getObj(e){if("undefined"!=typeof JSON)try{return JSON.parse(e)}catch(t){return null}}CacheLevel={Page:1,Session:2,Storage:3},APIMethod={POST:"POST",JSONP:"JSONP"},APIClient={EnablesAllowClientCache:!1,ForceAllowClientCacheClosed:!1,CacheLevel:CacheLevel.Page,DefaultCallMethod:APIMethod.POST,BaseUrl:undefined,ApiRequestParams:["AllowClientCache","Hash","JSONPCallback"],RequestData:"RequestData",callApi:function(e,t,a,n){void 0===n&&(n=this.DefaultCallMethod),n==APIMethod.JSONP?this.getApi(e,t,a):this.postApi(e,t,a)},getApi:function(e,t,a){0<(e=this.buildReqUrl(e)).indexOf("?")?e+="&JSONPCallback=?":e+="?JSONPCallback=?";var n=this.initAjax(e,t,a),l=n.RequestHash;t=n.ReqData,$.ajax({url:e,type:"GET",dataType:"JSONP",data:t,success:APIClient.apiCallback(a,l)})},postApi:function(e,t,a){e=this.buildReqUrl(e);var n=this.initAjax(e,t,a),l=n.RequestHash;t=n.ReqData,$.ajax({url:e,type:"POST",dataType:"JSON",data:t,success:APIClient.apiCallback(a,l)})},apiCallback:function(n,l){return function(e,t,a){e!=undefined&&null!=e?(1==e.ClientCached?e=APIClient.getData(e.Hash):(APIClient.setData(e.Hash,e),APIClient.setData(l,e.Hash)),n(e,t,a)):alert("请求异常，请稍后重试!")}},initAjax:function(e,t,a){if(t==undefined||null==t)t={};else{var n=t;for(var l in(t={})[this.RequestData]=n[this.RequestData],t[this.RequestData]!=undefined&&null!=t[this.RequestData]||(t[this.RequestData]={}),n)0<=this.ApiRequestParams.indexOf(l)?t[l]=n[l]:l!=this.RequestData&&(t[this.RequestData][l]=n[l])}t.Hash="";var i=getJSON(t),s=md5(i+e),r=APIClient.getData(s,!0);if(r!=undefined&&null!=r&&""!=trim(r)){var o=APIClient.getData(r);o!=undefined&&null!=o?t.Hash=r:(APIClient.clearData(s),APIClient.clearData(r))}return 1==APIClient.ForceAllowClientCacheClosed?t.AllowClientCache=!1:t.AllowClientCache==undefined&&(t.AllowClientCache=APIClient.EnablesAllowClientCache),{RequestHash:s,ReqData:t}},buildReqUrl:function(e){return this.BaseUrl!=undefined&&0<trim(this.BaseUrl).length&&e.toLowerCase().search("http://")<0&&e.toLowerCase().search("https://")<0&&(e=this.BaseUrl+e),e},getData:function(e,t){var a=this.storage().getData(e);return null==a||a==undefined?(this.storage().clearData(e),null):(t||null!=a&&a!=undefined||(APIClient.CacheLevel!=CacheLevel.Page?APIClient.CacheLevel=CacheLevel.Page:1==APIClient.EnablesAllowClientCache?APIClient.EnablesAllowClientCache=!1:APIClient.ForceAllowClientCacheClosed=!0),a)},setData:function(e,t){this.storage().setData(e,t)},clearData:function(e){this.storage().clearData(e)},storage:function(){switch(APIClient.CacheLevel){case CacheLevel.Storage:if(LocalStorage.isSupport())return APIClient.CacheLevel=CacheLevel.Storage,LocalStorage;case CacheLevel.Session:if(SessionStorage.isSupport())return APIClient.CacheLevel=CacheLevel.Session,SessionStorage;case CacheLevel.Page:if(PageStorage.isSupport())return APIClient.CacheLevel=CacheLevel.Page,PageStorage;default:return APIClient.CacheLevel=CacheLevel.Page,PageStorage}}},$.APIClient=APIClient,PageStorage={cacheData:[],getData:function(e){return this.cacheData[e]},setData:function(e,t){this.cacheData[e]=t},clearData:function(e){this.cacheData[e]=null},isSupport:function(){return!0}},SessionStorage={getData:function(e){return getObj(sessionStorage.getItem(e))},setData:function(e,t){var a=getJSON(t);if(null!=a){var n=getJSON(sessionStorage).length;try{sessionStorage.setItem(e,a)}catch(l){sessionStorage.clear(),a.length<n&&sessionStorage.setItem(e,a)}}},clearData:function(e){sessionStorage.removeItem(e)},isSupport:function(){return"undefined"!=typeof sessionStorage}},LocalStorage={getData:function(e){return getObj(localStorage.getItem(e))},setData:function(e,t){var a=getJSON(t);if(null!=a){var n=getJSON(localStorage).length;try{localStorage.setItem(e,a)}catch(l){localStorage.clear(),a.length<n&&localStorage.setItem(e,a)}}},clearData:function(e){localStorage.removeItem(e)},isSupport:function(){return"undefined"!=typeof localStorage}};