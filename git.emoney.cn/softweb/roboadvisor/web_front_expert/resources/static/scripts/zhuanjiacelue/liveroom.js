window.de=parseInt(1e4*Math.random()),window.nowtime="",window.liveShowDate="",window.IsLogin=0,$(function(){window.liveContentCache={},window.getLiveRoom=function(l){function s(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),a=window.location.search.substr(1).match(t);return null!=a?unescape(a[2]):null}function o(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),a=$.cookie("expertnews.ssourl").substr(1).match(t);return null!=a?unescape(a[2]):null}var c=null,r=window.gConfig.zyapiyqq,e=r+"api/Live/GetLiveContentInfoByType",t=r+"api/Live/GetLiveContentInfoIncreByType",a=1,n=!0,d=!1,u={LiveName:"",LiveImg:"",LiveIntro:"",TagNameStr:"",startTime:"",allStartTime:""},i=(new Date,""),p=newGuid(),m="10094",g=l,f=window.WebSocket?1:0,v=$.cookie("expertnews.uid")||s("uid")||0,h=s("StrategyID");!function(){if(g){var e,t=new Date,a=t.getMonth()+1,n=t.getDate(),i="is_access_userlive"+(t.getFullYear()+"-"+a+"-"+n)+g;"1"!=$.cookie(i)&&(e=r+"api/Live/SetHotInfo",$.get(e,{lid:g,source:5},function(e){$.cookie(i,"1")}))}}();var w=function(){},T=function(e){try{MBiz._FailTimes++,5<=MBiz._FailTimes&&MBiz.stop()}catch(t){}},C=function(e){try{L(),MBiz._FailTimes++,5<=MBiz._FailTimes&&MBiz.stop()}catch(t){}},I=function(e){if("undefined"!=typeof e.data.LastUpdateTime&&(e.data.LastUpdateTime.slice(0,10)!=i.slice(0,10)&&(d=!0),i=e.data.LastUpdateTime),0<e.data.ContentNum||0<e.data.RepliedNum)return setTimeout(function(){c.LiveContentIncr()},de),void MBiz.initlongpoll(m,g,p,I,T,C,w,i,L)},L=function(){};1==f?MBiz.init(m,g,p,function(e){var t=JSON.parse(e.data);t.LastUpdateTime.slice(0,10)!=i.slice(0,10)&&(d=!0),i=t.LastUpdateTime,setTimeout(function(){c.LiveContentIncr()},de)},T,C,w):MBiz.initlongpoll(m,g,p,I,T,C,w,i,L),c={liveApiURL:r,Init:function(){1!=IsLogin?c.SSOUserLogin():c.getLiveRoomInfo(),window.livethumbUP(".like",v,appIDLiveInfo,"#iveNlPack2")},markStr:function(e){return e.substr(0,3)+"***"+e.substr(-3)},SSOUserLogin:function(){var e=$.cookie("expertnews.ssourl").substr(1);$.ajax({type:"get",timeout:ajaxTimeout,url:c.liveApiURL+"api/Live/SSOUserLogin?"+e,data:{},dataType:"json",success:function(e){0==e.RetCode&&(c.getLiveRoomInfo(),IsLogin=1)}})},getLiveRoomInfo:function(){$.ajax({type:"get",timeout:ajaxTimeout,url:c.liveApiURL+"api/Live/GetLiveRoom",data:{lid:g},dataType:"json",success:function(e){0==e.RetCode&&(u.LiveName=e.Data.LiveName,u.LiveImg=e.Data.LiveImg,u.LiveIntro=e.Data.LiveIntro,u.TagNameStr=e.Data.TagNameStr,u.IsSoftAuth=e.Data.IsSoftAuth,i=e.Data.NewContentTime.replace("T"," ").slice(0,10),c.updateVisitAddrNum(e.Data.VisitAddrNum,e.Data.FansNum,e.Data.IsSoftAuth),1==e.Data.IsSoftAuth?$("#gotoExpliveroom").hide():$("#gotoExpliveroom").show(),c.LoadZbPage())}})},updateVisitAddrNum:function(e,t,a){1==a?$("#gotoExpliveroom").hide():$("#gotoExpliveroom").show(),$("#bigCastHoter").html("热度:"+e),$("#curVisitAddrNum").html(e),$("#curFansNum").html(t)},LiveContentIncr:function(){$.support.cors=!0,$.ajax({type:"get",timeout:ajaxTimeout,url:t,data:{lid:g,newdate:nowtime,type:"1,2"},dataType:"json",success:function(e){0==e.RetCode&&c.refreshZbZlPage(e.Data)}})},refreshZbZlPage:function(e){var a="",t=$("#zbzx"),n=$.cookie("expertnews.uid")||s("uid")||0,i=s("StrategyID"),o=[];o.push({newsId:"group_"+l,uid:n,appId:appIDLiveInfo}),o.push({newsId:i,uid:n,appId:appIDLiveInfo}),$.each(e,function(e,t){3!=t.LiveFrom?a+=c.dispose.zhibotext(t):a+="",o.push({newsId:l+"_"+t.Id,uid:n,appId:appIDLiveInfo})}),c.clickLike(o),0<e.length&&(nowtime=e[0].CreateTime),""!=a&&(t.attr("data-filled")!=""+g&&(t.attr("data-filled",""+g),t.empty()),d&&(d=!1,t.empty()),t.prepend(a)),c.bingimg()},LoadZbPage:function(){$.ajax({type:"get",timeout:ajaxTimeout,url:e,data:{lid:g,date:i,page:a,type:"1,2"},dataType:"json",success:function(e){var t=[],a=0;0==e.RetCode&&(a=e.Data.length,(t=e.Data).length,c.refreshZbPage(t),0<a?(u.allStartTime=e.Data[a-1].CreateTime,n=!0,""==nowtime&&(nowtime=e.Data[0].CreateTime,u.startTime=e.Data[a-1].CreateTime)):n=!1)}})},pulldownLoadZbPage:function(){if(!n)return!1;a++,$.ajax({type:"get",timeout:ajaxTimeout,url:e,data:{lid:g,date:i,page:a,type:"1,2"},dataType:"json",success:function(e){var t;0==e.RetCode&&(0<e.Data.length?(n=!0,""==nowtime&&(nowtime=e.Data[0].CreateTime),t=c.freshFilterData(e.Data),c.refreshZbPage(t)):(n&&layer.tips("已加载全部","#iveNlPack2",{offset:["400px","50px"],tips:[2,"#cb4b4b"]}),n=!1))}})},freshFilterData:function(e){var n,i,t=u.allStartTime;return t=(t=t.replace("T"," ")).replace(/-/g,"/"),n=new Date(t),i=[],0<e.length&&$.each(e,function(e,t){var a=t.CreateTime;a=(a=a.replace("T"," ")).replace(/-/g,"/"),n>new Date(a)&&i.push(t)}),i},LoadZbnextPage:function(){$.ajax({type:"get",timeout:ajaxTimeout,url:e,data:{lid:g,date:i,page:a,type:"1,2"},dataType:"json",success:function(e){0==e.RetCode&&(c.refreshZbPage(e.Data),0<e.Data.length?(n=!0,""==nowtime&&(nowtime=e.Data[0].CreateTime)):n=!1)}})},LoadHdPage:function(){$.ajax({type:"get",timeout:ajaxTimeout,url:c.liveApiURL+"api/Live/GetTodayLiveQuestion",data:{lid:g,page:1},dataType:"json",success:function(e){0==e.RetCode&&(c.refreshHdPage(e.Data),0<e.Data.length)}})},refreshZbPage:function(e){var t,a="",n=$("#zbzx"),i=$.cookie("expertnews.uid")||s("uid")||0,o=[];$.each(e,function(e,t){t.LiveFrom<3?a+=c.dispose.zhibotext(t):a+="",o.push({newsId:l+"_"+t.Id,uid:i,appId:appIDLiveInfo})}),c.clickLike(o),t=$(a),$("img",t).each(function(e,t){var a=$(this);a.attr("layer-src",a.attr("src"))}),""!=a&&(n.attr("data-filled")!=g&&(n.attr("data-filled",""+g),n.empty()),n.append(t)),c.bingimg()},refreshHdPage:function(e){var a="";$.each(e,function(e,t){a+=c.dispose.wendatext(t)}),$("#wdzx").append(a)},dispose:{time:function(e){var t=e.split("T"),a=t[0].split("-")[1]+"-"+t[0].split("-")[2],n=t[1].split("+")[0];return a+" "+(n=n.split(":")[0]+":"+n.split(":")[1])},time2:function(e){var t=e.split("T"),a=(t[0].split("-")[1],t[0].split("-")[2],t[1].split("+")[0]);return a=a.split(":")[0]+":"+a.split(":")[1]},replaceTarget:function(e){return e=(e=e.replace(/target/gim,"dtarget")).replace(/<(a\s+href=['\"]{0,1}http[s]{0,1}:\/\/.+?['\"]{0,1})>(.+?)<\/a>/gim,"<$1 target='_blank'>$2</a>")},zhibotext:function(e){var t,a="";e.Content=e.Content.replace(/style\s*?=\s*?([‘"])[\s\S]*?\1/g," "),e.Content=c.dispose.replaceTarget(e.Content),e.Content=e.Content.replace(/<font>/g,""),e.Content=e.Content.replace(/<FONT>/g,""),e.Content=e.Content.replace(/<o:p> <\/o:p>/g,""),e.Content=e.Content.replace(/o:/g,""),e.Content=e.Content.replace(/<font>/g,""),e.Content=e.Content.replace(/<FONT>/g,""),e.Content=e.Content.replace(/<span>/g,""),e.Content=e.Content.replace(/<SPAN>/g,""),e.Content=e.Content.replace(/<SPANlang=EN-US>/g,""),e.Content=e.Content.replace(/<P>/g,""),e.Content=e.Content.replace(/<\/P>/g,""),e.Content=e.Content.replace(/<\/SPAN>/g,"");var n=new Date,i=n.getMonth()+1,o=i<=9?"0"+i:i,s=n.getFullYear()+"-"+("0"+o).slice(-2)+"-"+("0"+n.getDate()).slice(-2);if(e.CreateTime==undefined||null==e.CreateTime||0==e.CreateTime.length?e.CreateTime="":t=e.CreateTime.slice(0,10)==s?e.CreateTime.slice(11,16):e.CreateTime.slice(5,10)+" "+e.CreateTime.slice(11,16),""!=e.Content){var r=l+"_"+e.Id;a="<li><div class='timeline'>"+t+'<span class="tips-tit pull-right"><span class="vt-cell like" id="like'+r+'" data-channelid="'+r+'"><i class="icon-1" id="likeicon'+r+'"></i> <span class="liked" id="liked'+r+"\"> </span></span> </div><i class='poangle'><em></em></i><div class='txtline'>"+e.Content+"</div></li>"}return a},wendatext:function(e){var t="";return t+='<li><div class="qaShowbox">',t+='<div class="qaShowbox-p">',t+='<div class="qaQuestion">'+c.dispose.time2(e.AskTime)+"<div></div>",t+='   <div class="q-content"><span class="q-asker"><span class="q-sign">【问】</span>'+c.markStr(e.AskUserName)+" </span>： "+e.AskContent+"</div>",t+="</div>",e.AnswerContent&&(t+='<div class="qaAnser ">',t+='   <div class="a-liveanser ">',t+='       <span class="color-blue"><span class="a-sign">【答】</span>'+u.LiveName+" </span>： "+e.AnswerContent,t+="   </div>",t+='   <div class="clearfloat"></div>',t+="</div>"),t+="</div>",t+="</div></li>"},hbao:function(e){return""},godhf:function(e){return 0<e.indexOf("href")?function t(e){var t=e.match(/<a[^>]*href="([^"]*)"[^>]*>(.*?)<\/a>/g);for(var a in t){var n=t[a].split('"')[1],i="'"+n+"'";e=e.replace('href="'+n+'"','href="javascript:void(0)" onclick="javascript:page.goodsip('+i+')" ')}return e}(e):e}},getNowFormatDate:function(){var e=new Date,t=e.getMonth()+1,a=e.getDate();return 1<=t&&t<=9&&(t="0"+t),0<=a&&a<=9&&(a="0"+a),e.getFullYear()+"-"+t+"-"+a+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},getNowFormatDate2:function(){var e=new Date,t=e.getMonth()+1,a=e.getDate();return 1<=t&&t<=9&&(t="0"+t),0<=a&&a<=9&&(a="0"+a),e.getFullYear()+"-"+t+"-"+a+" "+e.getHours()+":"+e.getMinutes()},getNowFormatDate3:function(){var e=new Date,t=e.getMonth()+1,a=e.getDate();return 1<=t&&t<=9&&(t="0"+t),0<=a&&a<=9&&(a="0"+a),e.getFullYear()+"-"+t+"-"+a},bingimg:function(e){layer.photos({photos:"#zbzx",shade:.3,anim:5,end:function(){}})},addTotalZans:function(){var e=$("#curartTotalCount"),t=e.html();e.html(Number(t)+1)},clickLike:function(e,i){var o=$("#zbzx");$.ajax({type:"get",timeout:ajaxTimeout,contentType:"text/plain",dataType:"jsonp",url:window.gConfig.likeListDataServerJsonp,data:{jsondata:JSON.stringify(e)},success:function(e,t){if(e.isSucess){for(var a=0,n=0;n<e.message.length;n++)e.message[n].liked&&($("#like"+e.message[n].newsId).addClass("liked"),$("#likeicon"+e.message[n].newsId).html("&#xe66b;")),$("#liked"+e.message[n].newsId).text(e.message[n].likes),$("#liked"+e.message[n].newsId).length||(a+=e.message[n].likes);i&&$("#curartTotalCount").html(a)}else $(".liked",o).each(function(){$(this).text(0)}),i&&$("#curartTotalCount").html(0)},error:function(e,t,a){$(".liked",o).each(function(){$(this).text(0)}),i&&$("#curartTotalCount").html(0)}})}},window.pulldownLoad=function(){var e,t=null,a=!0;$(function(){(t=$("#iveNlPack2").getNiceScroll(0)).scrollend(function(){t.newscrolly==t.page.maxh&&a&&(a=!a,clearTimeout(e),e=setTimeout(function(){c.pulldownLoadZbPage(),a=!a},500))})})},window.livethumbUP=function(e,t,o,a){var n=a||document;$(n).on("click",e,function(){var a=$(this),e=a.attr("data-channelid"),n=$("#liked"+e),i=$("#likeicon"+e);a.hasClass("liked")||$.ajax({type:"get",dataType:"jsonp",url:window.gConfig.likeDataServerJsonp,data:{uid:t,newsId:e,appId:o,groupId:"group_"+g},success:function(e){a.addClass("liked");var t=n.html();n.html(Number(t)+1),c.addTotalZans(),i.html("&#xe66b;")},error:function(){a.addClass("liked");var e=n.html();n.html(Number(e)+1),c.addTotalZans(),i.html("&#xe66b;")}})})};var y=[];y.push({newsId:"group_"+l,uid:v,appId:appIDLiveInfo}),y.push({newsId:h,uid:v,appId:appIDLiveInfo}),c.clickLike(y,"group"),c.Init(),window.pulldownLoad(),setTimeout(function(){(e=document.createElement("Script")).src="http://img.tongji.emoney.cn/scripts/emoneyanalytics.js",$("body").append(e);var e,t=o("pid"),a=o("tid"),n=o("sid"),i=o("uid");""!=t&&null!=t||(t="0"),""!=a&&null!=a||(a="0"),""!=n&&null!=n||(n="0"),""!=i&&null!=i||(i="0"),(e=document.createElement("Script")).src="http://img.tongji.emoney.cn/scripts/emoneyanalyticsonlinetime.js",$("body").append(e),setTimeout(function(){$.EMoneyAnalyticsOnlineTime&&$.EMoneyAnalyticsOnlineTime.Init&&$.EMoneyAnalyticsOnlineTime.Init("1CC378329905FF776C4E6BB384743762","10094",t,a,n,i,g)},500)},1e3)}});