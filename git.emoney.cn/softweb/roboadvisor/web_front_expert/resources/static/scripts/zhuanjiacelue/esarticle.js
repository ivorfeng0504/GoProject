define(["jquery","cors","utils","layer","handlebars","nicescroll"],function($,cors,utils,layer,Handlebars,nicescroll){layer.config({path:window.gConfig.staticPath+"static/libs/layer/"}),$.support.cors=!0;var page={curPageOpts:{NewsID:0,ColumnID:16,StrategyID:0,currpage:1,pageSize:20,LiveID:0,ExpertLiveroom:pagerouter.yqqUserLive+"?lid=93&"+utils.EMSSO()},init:function(){var e=this;utils.appendSSO(),$.support.cors=!0,e.curPageOpts.NewsID=utils.GetQueryString("NewsID"),e.curPageOpts.ColumnID=utils.GetQueryString("ColumnID"),e.curPageOpts.LiveID=utils.GetQueryString("LiveID"),e.curPageOpts.StrategyID=utils.GetQueryString("StrategyID"),e.curPageOpts.currpage=utils.GetQueryString("currpage"),e.curPageOpts.pageSize=utils.GetQueryString("pageSize"),e.curPageOpts.ExpertLiveroom=pagerouter.yqqUserLive+"?lid="+utils.GetQueryString("LiveID")+"&"+utils.EMSSO(),$("#gotoExpliveroom").attr("href",e.curPageOpts.ExpertLiveroom),e.setScroll(),e.StrategyArticleShow(e.curPageOpts.NewsID),e.histArticlesBind(e.curPageOpts.StrategyID),e.share()},photoAlbums:function(){},setScroll:function(){$.each(["#medialistScroll","#medialistScroll2","#iveNlPack","#iveNlPack2","#acScrollbox","#yaowenNlPack","#iveYwNlPack"],function(e,t){0<$(t).length&&$(t).niceScroll({cursorcolor:"#666",cursoropacitymax:.5,touchbehavior:!1,cursorwidth:"6px",cursorborder:"0",cursorborderradius:"8px",autohidemode:!1})})},StrategyArticleShow:function(e){var t=this;""!=t.curPageOpts.NewsID&&$.get(window.gConfig.apiHost+"strategy/GetNextStrategyNewsListByCurrNews",{v:""+Math.random(),NewsID:e,ColumnID:t.curPageOpts.ColumnID,StrategyID:utils.GetQueryString("StrategyID"),currpage:t.curPageOpts.currpage,pageSize:t.curPageOpts.pageSize},function(e){0==e.RetCode&&(null==e.Message[1].NewsInfo&&(layer.msg("此条资讯已移除，请浏览其他资讯"),setTimeout(function(){window.history.back()},2e3)),document.title=e.Message[1].NewsInfo.Title+" - 专家策略",$("#artcleTitle").text(e.Message[1].NewsInfo.Title),e.Message[1].StrategyInfo&&(t.curPageOpts.LiveID=e.Message[1].StrategyInfo.LiveID,$("#articleComefrom").text("来源："+e.Message[1].StrategyInfo.StrategyName)),$("#articlePublishtime").text("　"+e.Message[1].NewsInfo.CreateTime.slice(5,10)+" "+e.Message[1].NewsInfo.CreateTime.slice(11,16)),$("#clickNum").text(e.Message[1].NewsInfo.ClickNum),$("#acScrollbox").getNiceScroll(0).doScrollTop(0,.01),$("#acScrollbox").html(e.Message[1].NewsInfo.NewsContent),$("#clickLikeBtn").attr("data-chanelid",e.Message[1].NewsInfo.ID),$("#clickLikeBtn").one("click",t.clickToLike),$("#gotoExpliveroom").attr("href",pagerouter.yqqUserLive+"?lid="+t.curPageOpts.LiveID+"&"+utils.EMSSO()),t.getClickLike(),window.getLiveRoom(e.Message[1].StrategyInfo.LiveID),t.currentBigCastor(e.Message[1].StrategyInfo))})},prenextArticle:function(e){utils.objToQuery(this.curPageOpts);if(0==e.RetCode&&0<e.Message.length){var t="";null!=e.Message[0].NewsInfo?t+='<div>上一条：<a class="linellips" data-NewsID='+e.Message[0].NewsInfo.ID+' href="javascript:;"> '+e.Message[0].NewsInfo.Title+" </a> </div>":t+="<div>　 </div>",null!=e.Message[2].NewsInfo?(utils.objToQuery(this.curPageOpts),t+='<div>下一条：<a class="linellips"  data-NewsID='+e.Message[2].NewsInfo.ID+' href="javascript:;"> '+e.Message[2].NewsInfo.Title+" </a> </div>"):t+="<div> 　 </div>",$("#prenextLine").html(t)}},histArticlesBind:function(e){var t=this;$("#hisArticleList,#prenextLine").on("click","a",function(){t.curPageOpts.NewsID=$(this).attr("data-newsid"),t.StrategyArticleShow(t.curPageOpts.NewsID)})},hotArticlesList:function(e){var r=this;r.curPageOpts.ColumnID=utils.GetQueryString("ColumnID"),r.curPageOpts.currpage=utils.GetQueryString("currpage"),r.curPageOpts.pageSize=utils.GetQueryString("pageSize");var t=["<ul>","{{#each Message}}",'    <li><a href="javascript:;" data-NewsID="{{ NewsInfo.ID }}" ><i class="icon-1">&#xe637;</i>{{ NewsInfo.Title }}</a></li>',"{{/each}}","</ul>"].join("");Handlebars.registerHelper("renderTime",function(e){return e=e==undefined||null==e||0==e.length?"":e.substr(0,10),new Handlebars.SafeString(e)});var n=Handlebars.compile(t);$.get(window.gConfig.apiHost+"strategy/GetStrategyNewsList",{ColumnID:16,StrategyID:e,currpage:1,pageSize:10},function(e){var t={Message:[]};if(0==e.RetCode&&0<e.Message.length){for(var i=0,s=e.Message.length;i<s&&!(e.Message[i].NewsInfo.ID!=r.curPageOpts.NewsID&&(t.Message.push(e.Message[i]),3<=t.Message.length));i++);if(t.Message=t.Message.slice(0,3),0<t.Message.length){var a=n(t);$("#hisArticleList").html(a)}else $("#hisArticleList").html("<div>暂无其他文章</div>")}})},currentBigCastor:function(e){var t=e,i=pagerouter.zhuanjiacelueList+"?StrategyID="+e.ID+"&LiveID="+this.curPageOpts.LiveID,s=['<div class="item">','\t<div class="item-heading">','\t\t<a href="'+i+'" ><div class="media">','\t\t\t<img src="{{StrategyImg}}" alt="">',"\t\t</div></a>","\t</div>",'\t<div class="item-content">',"\t\t<h4>",'\t\t<a href="'+i+'" >{{StrategyName}}</a>',"\t\t</h4>",'\t\t<div class="text"><a href="'+i+'" > {{BigCastorSummary StrategySummary}}</a> </div>',"\t</div>",'\t<div class="clearfloat"></div>',"</div>"].join("");Handlebars.registerHelper("isfirst",function(e){return v1==v2?options.fn(this):options.inverse(this)});var a=Handlebars.compile(s);Handlebars.registerHelper("BigCastorSummary",function(e){var t,i=$("<div>"+e+"</div>").text();return t=i.length>(i=i.slice(0,50)).length?"…":"",new Handlebars.SafeString(i+t)});var r=a(t);$("#bigCastSpeaker").html(r)},jinnangshow:function(e){utils.GetQueryString("LiveID");var t=pagerouter.yqqUserLive+"?lid="+this.curPageOpts.LiveID+"&"+utils.EMSSO(),i=['<div class="item">','\t<div class="item-content">',"\t\t<b>",'\t\t<a href="'+t+'" target="_blank"> {{BagName}}</a>',"\t\t</b>",'\t\t<div class="text"><a href="'+t+'" target="_blank"><div>{{contentSummary BagSummary}}</div></a></div>',"\t</div>","</div>"].join(""),s=Handlebars.compile(i);Handlebars.registerHelper("contentSummary",function(e){var t,i=$("<div>"+e+"</div>").text();return t=i.length>(i=i.slice(0,50)).length?"…":"",new Handlebars.SafeString(i+t)}),$.ajax({url:window.gConfig.apiHost+"yqq/getskilbag",data:{lid:e},timeout:ajaxTimeout,success:function(e){var t=JSON.parse(e);if(0==t.RetCode&&0<t.Data.length){var i=s(t.Data[0]);$("#jinnangPack").html(i)}else $("#jinnangPack").html(t.RetMsg)}})},clickToLike:function(){var e=utils.getUID(),t=utils.GetQueryString("NewsID"),i=utils.GetQueryString("StrategyID"),s=appIDnewsinfo,a=appIDstrategyinfo,r=$(".clickbtn-like"),n=$(".icon-1",r),l=$(".clickLikes",r),c=$.getUUID().slice(-20);r.hasClass("liked")||($.ajax({type:"get",timeout:ajaxTimeout,url:window.gConfig.likeDataServerJsonp,contentType:"text/plain",dataType:"jsonp",data:{uid:e+"_"+c,newsId:i,appId:a},success:function(e,t){"success"===t&&e.isSucess}}),$.ajax({type:"get",timeout:ajaxTimeout,url:window.gConfig.likeDataServerJsonp,contentType:"text/plain",dataType:"jsonp",data:{uid:e,newsId:t,appId:s},success:function(e,t){l.text(parseInt(l.text())+1),r.addClass("liked"),n.html("&#xe66b;"),"success"===t&&e.isSucess}}))},getClickLike:function(){var e=uitls.getUID(),t=utils.GetQueryString("NewsID"),i=appIDnewsinfo,s=$(".clickbtn-like"),a=$(".icon-1",s),r=$(".clickLikes",s);$.ajax({type:"get",timeout:ajaxTimeout,url:window.gConfig.likeDataServerJsonp,contentType:"text/plain",dataType:"jsonp",data:{uid:e,newsId:t,appId:i},dataType:"json",success:function(e,t){"success"===t&&e.isSucess&&(r.text(e.message.likes),!0===e.message.liked?(s.addClass("liked"),a.html("&#xe66b;")):(s.removeClass("liked"),a.html("&#xe61b;")))}})},share:function(){var _this=this;with(window._bd_share_config={common:{bdSnsKey:{},bdText:"",bdUrl:pagerouter.share+"?type=2&NewsID="+_this.curPageOpts.NewsID+"&ColumnID="+_this.curPageOpts.ColumnID+"&StrategyID="+_this.curPageOpts.StrategyID+"&currpage="+_this.curPageOpts.currpage+"&pageSize="+_this.curPageOpts.pageSize,bdMini:"2",bdMiniList:!1,bdPic:"",bdStyle:"0",bdSize:"16"},share:{}},document)(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion="+~(-new Date/36e5)}};page.init()});