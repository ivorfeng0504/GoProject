var roomid;wsurl="ws://wsproxy.emoney.cn/ws/onsocket",longpollurl="http://wsproxy.emoney.cn/poll/onpolling",de=parseInt(1e4*Math.random()),nowtime="";var ajaxTimeout=1e4,isZhuanjiacelueList=!1,newLiveMessage=0,curWSID=0,questimer=null,initLiveRoomAjax=null;window.niceScrollGroups=window.niceScrollGroups||{},function(){var c,s=window.gConfig.zyapiyqq,e=s+"api/Live/GetLiveContentInfoByType",t=s+"api/Live/GetLiveContentInfoIncreByType",a=s+"api/Live/GetTodayLiveQuestionDes",n=s+"api/Live/GetMyLiveQuestion",o=s+"api/Live/GetMyLiveQuestionByDay",l=s+"api/LiveAnswer/GetAnswerScoreInfo";function d(e,i){return function t(e,i){try{return function t(){return window.external.EmObj}().EmFunc(e,i)}catch(a){}}(e,i)}$("#inpFacemark").qqFace({assign:"id_expertquestion",path:"http://static.emoney.cn/live/Content/images/arclist/"});var r=1,u=!0,p=!0,m=!1,v=utils.GetQueryString("LiveID"),w=(utils.GetQueryString("StrategyID"),utils.EMSSO()),g=utils.getUID(),f={LiveName:"",LiveImg:"",LiveIntro:"",TagNameStr:"",questionType:"all",allStartTime:"",AdviserName:"",AdviserNo:""},h=new Array,x="",y=0,b="";window.lastUpdateTime="",window.isLiveTab=!0;var S=function T(){for(var e="",i=1;i<=32;i++)e+=Math.floor(16*Math.random()).toString(16),8!=i&&12!=i&&16!=i&&20!=i||(e+="-");return e}(),C="10094";window.Groupid=v;var L,k=window.WebSocket?1:0,I={AskContent:"",AskUserName:"我",AskTime:"",AnswerContent:null},N=$("#d11"),D=$("#zhiBo"),A=$("#datePick"),G=$("#historyDate"),M=$(".curlive-content");G.on("click",function(){var e=$(this),i=c.dispose.getNowDate();newLiveMessage=0,window.lastUpdateTime=i,r=1,e.removeClass("open"),D.text("今日直播"),N.val(i),$(".live-type").find("b").removeClass("active").eq(0).addClass("active"),$("#iveNlPack2").show(),window.getLiveRoomInfo(window.Groupid),M.getNiceScroll(0).doScrollTop(2,.01)}),window.livethumbUP=function(e,i,s,t){t=t||document;$(t).on("click",e,function(){var t=$(this),e=t.attr("data-channelid"),a=$("#liked"+e),n=$("#likeicon"+e);t.hasClass("liked")||$.ajax({type:"get",dataType:"jsonp",url:window.gConfig.likeDataServerJsonp,data:{uid:i,newsId:e,appId:s,groupId:"group_"+window.Groupid,from:"pc"},success:function(e){t.addClass("liked");var i=a.html();a.html(Number(i)+1),c.addTotalZans(),n.html("&#xe66b;")},error:function(){var e=a.html();a.html(Number(e)+1),c.addTotalZans(),n.html("&#xe66b;")}})})},window.liveMyAskthumbUP=function(e,t,a,i){var n=i||document;$(n).on("click",e,function(){var i=$(this),e=i.attr("data-channelid");i.hasClass("active")||$.ajax({type:"get",dataType:"jsonp",url:window.gConfig.likeDataServerJsonp,data:{uid:t,newsId:e,appId:a,groupId:"live_"+window.Groupid},success:function(e){i.addClass("active").html('<i class="icon-1">&#xe66b;</i>有帮助'),c.addTotalZans()},error:function(){i.addClass("active").html('<i class="icon-1">&#xe66b;</i>有帮助'),c.addTotalZans()}})})},(L={resetLiveContboxSize:function(){var e=this;e.reCountLiveCntSize(),$(window).resize(function(){e.reCountLiveCntSize()})},reCountLiveCntSize:function(){$(".celue-live-page .curlive-content").height($(window).height()-$("#submitLine").height()-$("#liveListNav").height()-157)}}).reCountLiveCntSize(),$(window).resize(function(){L.resetLiveContboxSize()}),$(".celue-mcnt-v2 .curlive-content").height(356),$(".strategy-art-aside .curlive-content").height(356);var F=function(e){if(e.data){z(JSON.parse(e.data));var i=null;0<JSON.parse(e.data).RepliedNum&&(clearTimeout(i),i=setTimeout(function(){c.LoadQAPage()},de))}},U=function(){},P=function(e){try{MBiz._FailTimes++,5<=MBiz._FailTimes&&MBiz.stop()}catch(i){}},q=function(e){try{Q(),MBiz._FailTimes++,5<=MBiz._FailTimes&&MBiz.stop()}catch(i){}},R=function(e){if(e.data){if(z(e.data),0<e.data.RepliedNum)return setTimeout(function(){c.LoadQAPage()},de),void MBiz.initlongpoll(C,window.Groupid,S,R,P,q,"",e.data.LastUpdateTime,Q);"undefined"!=typeof e.data.LastUpdateTime?MBiz.initlongpoll(C,Groupid,S,R,P,q,"",e.data.LastUpdateTime,Q):MBiz.initlongpoll(C,Groupid,S,R,P,q,"",window.nowtime,Q)}},z=function(e){e&&0<e.ContentNum&&(e.LastUpdateTime.slice(0,10)!=nowtime.slice(0,10)&&(nowtime=c.dispose.getNowDate()+"00:00:00",m=!0),setTimeout(function(){c.LiveContentIncr(e)},de))},Q=function(){!function e(){null!=questimer&&clearInterval(questimer);questimer=setInterval(function(){z()},1e4)}()};$("#submitQuestion").click(function(e){if(h.push(new Date),$(".gradewrap").length)layer.msg("请您对上次的问题体验做出评价");else{if(1<h.length&&h[h.length-1].getTime()-h[h.length-2].getTime()<1e4)return x="提交过于频繁，请稍后再试！",void layer.msg(x);if(0==y)return x="您还未登录",void layer.msg(x);if(""==$.trim($("#id_expertquestion").val()))return x="提问内容不能为空",void layer.msg(x);var i=function t(e){return e=(e=(e=(e=(e=e.replace(/\</g,"&lt;")).replace(/\>/g,"&gt;")).replace(/\n/g,"<br/>")).replace(/？/g,"?")).replace(/\[em_([0-9]*)\]/g,'<img src="http://static.emoney.cn/live/Content/images/arclist/$1.gif" border="0" />')}($("#id_expertquestion").val());I.AskContent=i,I.AskTime=c.dispose.getNowTime(),$.ajax({type:"post",url:s+"api/WeChat/SetUserQuestion?"+w.replace(/&source=[\d|l]+/gi,""),data:{lid:window.Groupid,question:i,source:5},dataType:"json",success:function(e){var i="",t=0;0==e.RetCode?($("#questionBox").attr("data-load",""),$("#myquestionBox").attr("data-load",""),$("#id_expertquestion").val(""),"您暂无问答内容"==$("#myquestionBox").text()&&$("#myquestionBox").empty(),""!=e.Data?(i="亲，老师已经休息，您的问题已提交成功，老师会在明天第一时间看到并回复，您也可在“我的问答”里查看",layer.msg(i,{time:2e4})):(i="您的问题已提交成功，请等待老师回复！",layer.msg(i)),$("#myquestionBox").prepend(c.dispose.wendatext(I))):-2==e.RetCode?(x=e.RetMsg,t=layer.confirm(x,{title:"提示",btn:["立即登录","再看看"]},function(){layer.close(t),d("EM_FUNC_USERREGISTER","")},function(){layer.close(t)})):(x=e.RetMsg,layer.msg(x))}})}}),c={Init:function(){c.bindLiveNavEvent(),window.livethumbUP(".like",g,appIDLiveInfo,"#zbzx"),window.liveMyAskthumbUP(".is-help",g,appIDLiveInfo,"#myquestionBox"),c.appendSendFlowers(),c.appendLiveGiftBtn(),c.bindSubmitEvent()},appendSendFlowers:function(){var e='<div class="send-flowers" id="sendFlowers'+window.Groupid+'" data-curClickTime=""><div class="dz_flybox"></div><div class="image"></div><div class="flower-number">0</div></div>';$(".inp-pack").prepend(e)},markStr:function(e){var i=e+"",t=i.length;return 6<t?i.substr(0,3)+"***"+i.substr(t-3):i.substr(0,3)+"***"+i.substr(3)},addTotalZans:function(){var e=$("#curartTotalCount"),i=e.html();e.html(Number(i)+1)},clickLike:function(e,n){var s=$("#zbzx");$.ajax({type:"get",timeout:ajaxTimeout,contentType:"text/plain",dataType:"jsonp",url:window.gConfig.likeListDataServerJsonp,data:{jsondata:JSON.stringify(e)},success:function(e,i){if(e.isSucess){for(var t=0,a=0;a<e.message.length;a++)e.message[a].liked&&($("#like"+e.message[a].newsId).addClass("liked"),$("#likeicon"+e.message[a].newsId).html("&#xe66b;")),$("#liked"+e.message[a].newsId).text(e.message[a].likes),$("#liked"+e.message[a].newsId).length||(t+=e.message[a].likes);n&&$("#curartTotalCount").html(t)}else $(".liked",s).each(function(){$(this).text(0)}),n&&$("#curartTotalCount").html(0)},error:function(e,i,t){$(".liked",s).each(function(){$(this).text(0)}),n&&$("#curartTotalCount").html(0)}})},bindLiveNavEvent:function(){$("#zbzx"),$("#questionBox");var e=$("#curLiveContent"),t=$(".curlive-content",e);$("#liveListNav").on("click",".live-type b",function(){var e=$(this),i=e.attr("data-target");window.isLiveTab="iveNlPack2"==i,e.hasClass("active")||(e.addClass("active").siblings().removeClass("active"),t.hide(),"allQuestionPack"==i?"loaded"!=$("#questionBox").attr("data-load")&&c.LoadQAPage():"myQuestionPack"==i?"loaded"!=$("#myquestionBox").attr("data-load")&&c.LoadMyQuestion():G.empty(),$("#"+i).show())})},livePV:function(){if(window.Groupid){var e,i=new Date,t=i.getMonth()+1,a=i.getDate(),n="is_access_userlive"+(i.getFullYear()+"-"+t+"-"+a)+window.Groupid;"1"!=$.cookie(n)&&(e=s+"api/Live/SetHotInfo",$.get(e,{lid:window.Groupid,source:5,uid:g},function(e){$.cookie(n,"1")}))}},getLiveRoomInfo:function(e){window.Groupid=e==undefined?window.Groupid:e,newLiveMessage=0,window.isLiveTab=!0,r=1,$("#submitLine .send-flowers").attr("id","sendFlowers"+window.Groupid),$("#submitLine .send-flowers").removeClass("likeed"),c.getSendFlowers(),c.addSendFlowers(),initLiveRoomAjax&&initLiveRoomAjax.abort(),initLiveRoomAjax=$.ajax({type:"get",url:s+"api/Live/SSOAndGetLiveData?lid="+window.Groupid+"&page="+r+"&date="+window.lastUpdateTime+"&type=1,2,7&"+w,dataType:"json",success:function(e){p=!0;var i,t,a=[],n=0;0==e.RetCode?(y=1,A.addClass("open"),f.LiveName=e.Data.room.LiveName,f.LiveImg=e.Data.room.LiveImg,f.LiveIntro=e.Data.room.LiveIntro,f.TagNameStr=e.Data.room.TagNameStr,f.AdviserName=e.Data.room.AdviserName,f.AdviserNo=e.Data.room.AdviserNo,"0001-01-01"==e.Data.room.NewContentTime.substr(0,10)&&(e.Data.room.NewContentTime=e.Data.room.LastModifyTime),n=e.Data.contentlist.length,b!=window.Groupid&&(c.livePV(),b=window.Groupid,$("#iveNlPack2").getNiceScroll(0).doScrollTop(2,.01),t=new Date,i=window.lastUpdateTime?window.lastUpdateTime:t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" 00:00:00",""!=window.Groupid&&(MBiz._sockdelete(curWSID),curWSID=1==k?MBiz.init(C,window.Groupid,S,F,P,q,U):MBiz.initlongpoll(C,window.Groupid,S,R,P,q,U,i,Q)),N.val(c.dispose.getNowDate()),"celue_list"==window.liveSource&&c.updateVisitAddrNum(e.Data.room.VisitAddrNum,e.Data.room.FansNum,e.Data.room.IsSoftAuth),c.updateVisitAddrNum(e.Data.room.VisitAddrNum,e.Data.room.FansNum,e.Data.room.IsSoftAuth)),window.liveSource,0<(a=e.Data.contentlist).length&&(f.startTime=a[a.length-1].LastModifyTime),c.refreshZbPage(a),$("#zbzx").attr("data-lastUpdateTime",window.lastUpdateTime),0<n?(f.allStartTime=e.Data.contentlist[n-1].CreateTime,u=!0,""==nowtime&&(nowtime=e.Data.contentlist[0].CreateTime,f.startTime=e.Data.contentlist[n-1].CreateTime),f.startTime=f.startTime.replace("T"," ")):u=!1):layer.alert(e.RetMsg,{title:"提示"})}})},updateVisitAddrNum:function(e,i,t){1==t?$("#gotoExpliveroom").hide():$("#gotoExpliveroom").show(),$("#bigCastHoter").html("热度:"+e),$("#curVisitAddrNum").html(e),$("#curFansNum").html(i)},LiveContentIncr:function(i){$.support.cors=!0,nowtime=nowtime.replace("T"," "),$.ajax({type:"get",url:t,data:{lid:window.Groupid,newdate:nowtime,type:"1,2,7"},dataType:"json",success:function(e){0==e.RetCode&&0<e.Data.length&&(""!=window.lastUpdateTime&&i.LastUpdateTime.slice(0,10)!=window.lastUpdateTime.slice(0,10)||c.refreshZbZlPage(e.Data),(""!=window.lastUpdateTime&&i.LastUpdateTime.slice(0,10)!=window.lastUpdateTime.slice(0,10)||!window.isLiveTab)&&0<i.ContentNum&&(newLiveMessage+=i.ContentNum,setTimeout(function(){G.addClass("open").html('<span class="total "></span>'),G.find(".total").addClass("open").text("有"+newLiveMessage+"条新消息")},de)))}})},refreshZbZlPage:function(e){var t="",i=$("#zbzx"),a=utils.getUID(),n=[];$.each(e,function(e,i){3!=i.LiveFrom?i.Id!=window.currentLiveNewsIdList[e]&&(t+=c.dispose.zhibotext(i)):7==i.LiveFrom?t+=c.dispose.rewardshow(i):t+="",n.push({newsId:i.Id,uid:a,appId:appIDLiveInfo,from:"pc"}),n.length%15==0&&(c.clickLike(n),n=[])}),c.clickLike(n),0<e.length&&(nowtime=e[0].CreateTime),""!=t&&(i.attr("data-filled")!=""+window.Groupid&&(i.attr("data-filled",""+window.Groupid),i.empty()),m&&(m=!1,i.empty()),i.prepend(t)),c.bingimg()},loadQuestionList:function(){$.ajax({type:"get",url:n,data:{lid:window.Groupid,date:window.lastUpdateTime,page:r},dataType:"json",success:function(e){var t=[],i=0;0==e.RetCode&&(i=e.Data.length,$.each(e.Data,function(e,i){1==i.LiveFrom&&t.push(i)}),0<t.length&&(f.startTime=t[t.length-1]),c.refreshZbPage(t),0<i?(f.allStartTime=e.Data[i-1].CreateTime,u=!0,""==nowtime&&(nowtime=e.Data[0].CreateTime,f.startTime=e.Data[i-1].CreateTime)):u=!1,f.startTime=f.startTime.replace("T"," "))}})},pulldownLoadZbPage:function(){if(!u)return!1;r++,$.ajax({type:"get",url:e,data:{lid:window.Groupid,date:window.lastUpdateTime,page:r,type:"1,2,7"},dataType:"json",success:function(e){var i;0==e.RetCode?0<e.Data.length?(u=!0,""==nowtime&&(nowtime=e.Data[0].CreateTime),i=c.freshFilterData(e.Data),c.refreshZbPage(i),setTimeout(function(){utils.InitNiceScroll("#iveNlPack2")},0)):(u&&layer.tips("已加载全部","#iveNlPack2",{offset:["400px","50px"],tips:[4,"#cb4b4b"]}),u=!1,r--):(u=!1,r--)},error:function(){u=!1,r--}})},freshFilterData:function(e){var a,n,i=f.allStartTime;return i=(i=i.replace("T"," ")).replace(/-/g,"/"),a=new Date(i),n=[],0<e.length&&$.each(e,function(e,i){var t=i.CreateTime;t=(t=t.replace("T"," ")).replace(/-/g,"/"),a>new Date(t)&&n.push(i)}),n},refreshZbPage:function(e){var i,t="",a=$("#zbzx"),n=utils.getUID(),s=[];window.currentLiveNewsIdList=[];var o=(a.attr("data-lastupdatetime")+"").substr(0,10);$.each(e,function(e,i){i.LiveFrom<3?t+=c.dispose.zhibotext(i):"7"==i.LiveFrom?t+=c.dispose.rewardshow(i):t+="",s.push({newsId:i.Id,uid:n,appId:appIDLiveInfo,from:"pc"}),window.currentLiveNewsIdList.push(i.Id),s.length%15==0&&(c.clickLike(s),s=[])}),c.clickLike(s),i=$(t),""!=t&&(a.attr("data-filled")!=window.Groupid&&(a.attr("data-filled",""+window.Groupid),a.empty()),1==m&&(m=!1,a.empty()),o!=(window.lastUpdateTime+"").substr(0,10)&&a.empty(),a.append(i)),c.bingimg()},LoadQAPage:function(){if(!p)return!1;$.ajax({type:"get",url:a+"?lid="+window.Groupid+"&page=0&date="+window.lastUpdateTime+w,dataType:"json",success:function(e){0==e.RetCode?c.refreshQAPage(e.Data):-1==e.RetCode&&$("#questionBox").html(e.RetMsg)}})},getAnswerScoreList:function(i){$.ajax({type:"get",timeout:ajaxTimeout,url:l,data:{_v:(new Date).getTime()},dataType:"json",success:function(e){c.showAnswerScore(i,e)},error:function(){},faild:function(){}})},showAnswerScore:function(e,t){var a=JSON.parse(t);if("0"==a.RetCode){var n={},s={"1.0":'<i class="icon-1">&#xe610;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i>',1.5:'<i class="icon-1">&#xe610;</i><i class="icon-1">&#xe6c9;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i>',"2.0":'<i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i>',2.5:'<i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe6c9;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i>',"3.0":'<i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i>',3.5:'<i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe6c9;</i><i class="icon-1">&#xe6d1;</i>',"4.0":'<i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe6d1;</i>',4.5:'<i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe6c9;</i>',"5.0":'<i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i>'};for(i=0,j=a.Data.length;i<j;i++)n[a.Data[i].AnswerUserId]=a.Data[i];$.each(e,function(e,i){n[e]&&(replyScoreHtml='<div class="replyScrore"><div><span class="scoreGivers">'+n[e].AllUserNum+'人已评分</span><span class="scoreBox">对他的评分:<span class="liveScore active">'+s[""+n[e].AvgScore.toFixed(1)]+'</span> </span><span class="scoreDetail"><span>质量 '+n[e].QualityScore.toFixed(1)+"</span><span> 响应 "+n[e].SpeedScore.toFixed(1)+" </span><span> 态度 "+n[e].MannerScore.toFixed(1)+"</span></span>  </div> </div>",$("#questionBox .AnswerUserId"+e).html(replyScoreHtml))})}},refreshQAPage:function(e){var t="",i=$("#questionBox"),a={};$.each(e,function(e,i){a[i.AnswerUserId]="1",t+=c.dispose.wendatext(i)}),c.getAnswerScoreList(a),0<e.length?p=!0:(p&&(t="暂无问答内容"),p=!1),i.html(t)},LoadMyQuestion:function(){var t=$("#myquestionBox");$.ajax({type:"get",url:o+"?"+w,data:{lid:window.Groupid,date:window.lastUpdateTime,page:0},dataType:"json",success:function(e){var i=0;0==e.RetCode?c.refreshMyQuestionPage(e.Data):-2==e.RetCode?(x=e.RetMsg,i=layer.confirm(x,{title:"提示",btn:["立即登录","再看看"]},function(){layer.close(i),d("EM_FUNC_USERREGISTER","")},function(){layer.close(i)})):"无用户状态，请登录"==e.RetMsg?t.html("您的账号在益圈圈无用户态，请登录后查看!"):t.html("您暂无问答内容")}})},refreshMyQuestionPage:function(e){var t="",i=$("#myquestionBox"),a=[];$.each(e,function(e,i){t+=c.dispose.wendatext(i,!0),a.push({newsId:i.Id,uid:g,appId:appIDLiveInfo,from:"pc"})}),e.length<=0&&(t="您暂无问答内容"),i.html(t)},dispose:{getNowTime:function(){var e=new Date;return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+"T"+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},getNowDate:function(){var e=new Date,i=e.getFullYear(),t=e.getMonth()+1,a=e.getDate();return 1<=t&&t<=9&&(t="0"+t),0<=a&&a<=9&&(a="0"+a),i+"-"+t+"-"+a},time:function(e){var i=e.split("T"),t=i[0].split("-")[1]+"-"+i[0].split("-")[2],a=i[1].split("+")[0];return t+" "+(a=a.split(":")[0]+":"+a.split(":")[1])},time2:function(e){var i=e.split("T"),t=i[0].split("-"),a=i[1],n=(("00"+t[1]).slice(-2),("00"+t[2]).slice(-2),a.split("+")[0]);return n=("00"+n.split(":")[0]).slice(-2)+":"+("00"+n.split(":")[1]).slice(-2)},replaceTarget:function(e){return e=(e=e.replace(/target/gi,"target1")).replace(/<(a\s+href=['\"]{0,1}http[s]{0,1}:\/\/.+?['\"]{0,1})>(.+?)<\/a>/gi,"<$1 target='_blank'>$2</a>")},zhibotext:function(e){var i,t="";e.Content=e.Content.replace(/style\s*?=\s*?([‘"])[\s\S]*?\1/g," "),e.Content=e.Content.replace(/<a\b[^>]+\bhref="([^"]*)"[^>]*>([\s\S]*?)<\/a>/gm,"$2"),e.Content=e.Content.replace(/<font>/g,""),e.Content=e.Content.replace(/<FONT>/g,""),e.Content=e.Content.replace(/<o:p> <\/o:p>/g,""),e.Content=e.Content.replace(/o:/g,""),e.Content=e.Content.replace(/<span>/g,""),e.Content=e.Content.replace(/<SPAN>/g,""),e.Content=e.Content.replace(/<SPANlang=EN-US>/g,""),e.Content=e.Content.replace(/<P>/g,""),e.Content=e.Content.replace(/<\/P>/g,""),e.Content=e.Content.replace(/<\/SPAN>/g,"");var a=new Date,n=a.getMonth()+1,s=n<=9?"0"+n:n,o=a.getFullYear()+"-"+("0"+s).slice(-2)+"-"+("0"+a.getDate()).slice(-2);if(e.CreateTime==undefined||null==e.CreateTime||0==e.CreateTime.length?e.CreateTime="":i=e.CreateTime.slice(0,10)==o?e.CreateTime.slice(11,16):e.CreateTime.slice(5,10)+" "+e.CreateTime.slice(11,16),""!=e.Content){var l=e.Id;t='<li><div class=\'timeline\'><span class="tips-tit pull-right"><span class="vt-cell like" id="like'+l+'" data-channelid="'+l+'"><i class="icon-1" id="likeicon'+l+'"></i> <span class="liked" id="liked'+l+'"> </span></span></span><span>'+i+"</span> </div><div class='txtline'>"+e.Content+"</div></li>"}return t},wendatext:function(e,i){var t="",a=e.NoReplyNum,n="",s=e.Status,o=!!i;if(""!=e.AskConten)e.Id;o&&10<a&&1===s&&(n="<div class='color-gray'>你前面还有"+a+"问题正在排队中，老师会逐一答复，请耐心等待...</div>"),t+='<li><div class="qaShowbox">',t+='<div class="qaShowbox-p">',t+='<div class="qaQuestion">'+c.dispose.time2(e.AskTime)+"<div></div>",t+='   <div class="q-content"><span class="q-asker"><span class="q-sign">【问】</span>'+c.markStr(e.AskUserName)+" </span>： "+e.AskContent+"</div>",t+="</div>",t+=n+"";var l="";return e.AnswerContent&&(l="【投资顾问"+(e.MasterNumber?e.MasterName+"，执业证书编号"+e.MasterNumber:f.AdviserName+"，执业证书编号"+f.AdviserNo)+"， 投资顾问意见仅作参考，不作为买卖建议。股市有风险，投资需谨慎！】",t+='<div class="qaAnser ">',t+='   <div class="a-liveanser ">',t+='       <span class="color-blue"><span class="a-sign">【答】</span>'+f.LiveName+" </span>： "+e.AnswerContent+l,t+="   </div>",t+='   <div class="clearfloat"></div>',t+="</div>",!e.IsKps&&o&&(t+=c.getScoreHtml(e))),t+='<div class="AnswerUserId'+e.AnswerUserId+'"> </div>',t+="</div>",t+="</div></li>"},rewardshow:function(e){var i="";return i+='<li class="live-reward">',i+='<div class="rw-iner">',i+='   <div class="timeline"><span>'+c.dispose.time2(e.CreateTime)+"</span></div>",i+='   <div class="txtline">',i+='       <div class="rw-info">',i+='           <div class="rw-title"><b class="username">'+c.markStr(e.NickName)+'</b>:打赏礼物：<span class="rw-cnt rw-type'+e.moneytype+'">'+({1:"顶住",2:"咖啡",3:"反弹",4:"利好",5:"太阳",6:"涨停"}[e.moneytype]||"礼物")+'<i class="rw-icon'+e.moneytype+'"></i></span></div>',i+='           <div class="rw-msg">'+e.Message+"</div>",i+="       </div>",i+="   </div>",i+="</div>",i+="</li>"},godhf:function(e){return 0<e.indexOf("href")?function i(e){var i=e.match(/<a[^>]*href="([^"]*)"[^>]*>(.*?)<\/a>/g);for(var t in i){var a=i[t].split('"')[1],n="'"+a+"'";e=e.replace('href="'+a+'"','href="javascript:void(0)" onclick="javascript:page.goodsip('+n+')"')}return e}(e):e}},getAnswerScoreList:function(i){$.ajax({type:"get",timeout:ajaxTimeout,url:l,data:{_v:(new Date).getTime()},dataType:"json",success:function(e){c.showAnswerScore(i,e)},error:function(){},faild:function(){}})},showAnswerScore:function(e,t){var a=JSON.parse(t),n={},s={"1.0":'<i class="icon-1">&#xe610;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i>',1.5:'<i class="icon-1">&#xe610;</i><i class="icon-1">&#xe6c9;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i>',"2.0":'<i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i>',2.5:'<i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe6c9;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i>',"3.0":'<i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i>',3.5:'<i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe6c9;</i><i class="icon-1">&#xe6d1;</i>',"4.0":'<i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe6d1;</i>',4.5:'<i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe6c9;</i>',"5.0":'<i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i><i class="icon-1">&#xe610;</i>'};for(i=0,j=a.Data.length;i<j;i++)n[a.Data[i].AnswerUserId]=a.Data[i];$.each(e,function(e,i){replyScoreHtml='<div class="replyScrore"><div><span class="scoreGivers">'+n[e].AllUserNum+'人已评分</span><span class="scoreBox">评分:<span class="liveScore active">'+s[""+n[e].AvgScore.toFixed(1)]+'</span> </span><span class="scoreDetail"><span>质量 '+n[e].QualityScore.toFixed(1)+"</span><span> 响应 "+n[e].SpeedScore.toFixed(1)+" </span><span> 态度 "+n[e].MannerScore.toFixed(1)+"</span></span>  </div> </div>",$("#questionBox .AnswerUserId"+e).html(replyScoreHtml)})},getScoreHtml:function(e){return'<div class="gradewrap" id="grade'+e.Id+'"><form>  \x3c!--问答记录ID--\x3e<input type="hidden" name="LiveQuestionAnswer_Id" value="'+e.Id+'">  \x3c!--提问者ID--\x3e<input type="hidden" name="AskUserId" value="'+e.AskUserId+'">  \x3c!--回答者ID--\x3e<input type="hidden" name="AnswerUserId" value="'+e.AnswerUserId+'">  \x3c!--上次更新时间--\x3e<input type="hidden" name="date" value="'+window.lastUpdateTime+'">  \x3c!--直播id--\x3e<input type="hidden" name="lid" value="'+e.LId+'"> <dl>     <dt>对回复评分</dt>     <dd>回复质量         <span class="starwrap"><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i></span><input type="hidden" name="QualityScore" value="0">     </dd>     <dd>响应速度         <span class="starwrap"><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i></span><input type="hidden" name="SpeedScore" value="0">     </dd>     <dd>服务态度         <span class="starwrap"><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i><i class="icon-1">&#xe6d1;</i></span><input type="hidden" name="MannerScore" value="0">     </dd> </dl> <div class="submitwrap">    <input type="submit" value="提交" class="btn hide">您的评分是我们前进的动力，请一定要评哦 </div></form></div>'},bindSubmitEvent:function(){var i=this,o="&#xe610;",l="&#xe6d1;";$(document).on("submit",".gradewrap form",function(){var e=$(this).serializeJson();return i.submitGrade(e),!1}).on("click",".starwrap .icon-1",function(){var e=$(this).index(),i=$(this).parent(),t=i.find(".icon-1");i.attr("data-size",e+1),t.html(l);for(var a=0;a<=e;a++)t.eq(a).html(o);$(this).parent().next().val(e+1),$(this).parents("form").find(".btn").hasClass("hide")&&$(this).parents("form").find(".btn").removeClass("hide")}).on("mouseenter mouseleave",".starwrap .icon-1",function(e){e.stopPropagation();var i=$(this).parent(),t=i.attr("data-size"),a=i.find(".icon-1");if("mouseenter"===e.type){for(var n=$(this).index(),s=n;s<5;s++)a.eq(s).html(l);for(s=0;s<n+1;s++)a.eq(s).html()!=o&&a.eq(s).html(o)}else for(a.html(l),t=t||0,s=0;s<t;s++)a.eq(s).html()!=o&&a.eq(s).html(o)})},submitGrade:function(a){$.ajax({type:"post",timeout:ajaxTimeout,dataType:"json",url:s+"api/LiveAnswer/MarkingLiveAnswer",data:a,success:function(e,i){var t=JSON.parse(e);"0"==t.RetCode?$("#grade"+a.LiveQuestionAnswer_Id).remove():"-2"==t.RetCode?($("#grade"+a.LiveQuestionAnswer_Id).remove(),layer.msg("不能重复提交")):layer.msg(t.RetMsg)},error:function(e,i,t){}})},getNowFormatDate:function(){var e=new Date,i=e.getMonth()+1,t=e.getDate();return 1<=i&&i<=9&&(i="0"+i),0<=t&&t<=9&&(t="0"+t),e.getFullYear()+"-"+i+"-"+t+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},getNowFormatDate2:function(){var e=new Date,i=e.getMonth()+1,t=e.getDate();return 1<=i&&i<=9&&(i="0"+i),0<=t&&t<=9&&(t="0"+t),e.getFullYear()+"-"+i+"-"+t+" "+e.getHours()+":"+e.getMinutes()},getNowFormatDate3:function(){var e=new Date,i=e.getMonth()+1,t=e.getDate();return 1<=i&&i<=9&&(i="0"+i),0<=t&&t<=9&&(t="0"+t),e.getFullYear()+"-"+i+"-"+t},bingimg:function(e){var l=[],r=$("#zbzx");"celue_live"!=window.liveSource?($("img:not([src*='.gif'])",r).each(function(){l.push({src:$(this).attr("src")}),$(this).attr("index",l.length)}),$("img:not([src*='.gif'])",r).unbind("click"),$("img:not([src*='.gif'])",r).bind("click",function(e){var i=$("img:not([src*='.gif'])",r),t=i.length;if(l.length<t)for(var a=l.length;a<t;a++){var n=i.eq(a).attr("src");l.push({src:n}),i.eq(a).attr("index",l.length)}var s=$(this).attr("index"),o=l.slice(s-1).concat(l.slice(0,s-1));layer.photos({photos:{data:o},shade:.3,anim:5,end:function(){}})})):"1"!=d("EM_FUNC_IMAGESHOW","")?$("img:not([src*='.gif'])",r).each(function(e,i){var t=$(this);t.parent().hasClass("wraplink")||t.wrap("<a href='"+t.attr("src")+"' target='_blank' class='wraplink'></a>")}):r.off().on("click","img:not([src*='.gif'])",function(){var e,i,t,a,n,s=$(this).attr("src"),o=.9*window.screen.width,l=.9*window.screen.height;if("undefined"==typeof this.naturalWidth){var r=new Image;r.src=this.src,e=r.width,i=r.height}else e=this.naturalWidth,i=this.naturalHeight;n=e/i,i<=e?o<=e?a=(t=o)/n:(t=e,a=i):l<i?(zoomh=l,zoomw=l*n):(t=e,a=i),d("EM_FUNC_IMAGESHOW","{|*"+s+"*|}{|*"+a+"&"+t+"*|}")})},getSendFlowers:function(){var a=$("#sendFlowers"+window.Groupid),n=$("#submitLine .flower-number"),e=c.dispose.getNowDate().replace(/-/g,""),i=[{newsId:"sendflowers_"+window.Groupid,uid:g,appId:appIDLiveInfo,from:"pc"}],t=[{newsId:"sendflowers_"+window.Groupid+"_"+e,uid:g,appId:appIDLiveInfo,from:"pc"}];$.ajax({type:"get",timeout:ajaxTimeout,contentType:"text/plain",dataType:"jsonp",url:window.gConfig.likeListDataServerJsonp,data:{jsondata:JSON.stringify(i)},success:function(e,i){if(e.isSucess)for(var t=0,a=0;a<e.message.length;a++)t=utils.preserveNDecimal(e.message[a].likes,1),n.text(t);else n.text(0)},error:function(e,i,t){n.text(0)}}),$.ajax({type:"get",timeout:ajaxTimeout,contentType:"text/plain",dataType:"jsonp",url:window.gConfig.likeListDataServerJsonp,data:{jsondata:JSON.stringify(t)},success:function(e,i){if(e.isSucess)for(var t=0;t<e.message.length;t++)e.message[t].liked&&a.addClass("likeed")},error:function(e,i,t){}})},addSendFlowers:function(){var r=$("#sendFlowers"+window.Groupid);r.off().on("click",function(){var e=$(this),i=(e.attr("data-curClickTime"),e.find(".flower-number")),t=parseInt(i.text()),a=c.dispose.getNowDate().replace(/-/g,""),n=Math.floor(3*Math.random()+1),s=$(".dz_flybox").children("img").length,o=parseInt(120*Math.random()),l=$(".dz_flybox");$("img:eq("+s+")",l);l.append("<img src=''>"),$("img:eq("+s+")",l).attr("src",imageURL+"/images/sendflowes/sendflower"+n+".png"),$("img:eq("+s+")",l).animate({bottom:"200px",opacity:"0",right:o+"px"},1300,"swing",function(){$(this).remove()}),e.hasClass("likeed")||(i.text(t+1),r.addClass("likeed"),$.ajax({url:window.gConfig.likeDataServerJsonp,type:"get",dataType:"jsonp",timeout:ajaxTimeout,cache:!1,data:{uid:g,newsId:"sendflowers_"+window.Groupid+"_"+a,appId:appIDLiveInfo,groupId:"sendflowers_"+window.Groupid,from:"pc"},success:function(e,i){},error:function(e,i,t){}}))})},appendLiveGiftBtn:function(){var i=['<div id="liveGift" class="liveGift" style="">','    <div class="livegift-pack">','        <div class="gift-wrap">',"            <ul>",'                <li class="gift-item"><label><input type="radio" name="gift-inp" value="1" />','                    <div class="gift-box gift-2">','                        <div class="gift-show">',"                            <i></i>","                            <b>顶住</b>","                        </div>",'                        <div class="gift-tit">￥3元</div>',"                    </div>","                </label></li>",'                <li class="gift-item"><label><input type="radio" name="gift-inp" value="2" />','                       <div class="gift-box gift-3">','                        <div class="gift-show">',"                            <i></i>","                            <b>咖啡</b>","                        </div>",'                        <div class="gift-tit">￥8元</div>',"                    </div></label></li>",'                <li class="gift-item"><label><input type="radio" name="gift-inp" value="3" />','                       <div class="gift-box gift-4">','                        <div class="gift-show">',"                            <i></i>","                            <b>反弹</b>","                        </div>",'                        <div class="gift-tit">￥28元</div>',"                    </div></label></li>",'                <li class="gift-item"><label><input type="radio" name="gift-inp" value="4" />','                       <div class="gift-box gift-5">','                        <div class="gift-show">',"                            <i></i>","                            <b>利好</b>","                        </div>",'                        <div class="gift-tit">￥28元</div>',"                    </div></label></li>",'                <li class="gift-item"><label><input type="radio" name="gift-inp" value="5" />','                       <div class="gift-box gift-6">','                        <div class="gift-show">',"                            <i></i>","                            <b>太阳</b>","                        </div>",'                        <div class="gift-tit">￥58元</div>',"                    </div></label></li>",'                <li class="gift-item"><label><input type="radio" name="gift-inp" value="6" />','                       <div class="gift-box gift-7">','                        <div class="gift-show">',"                            <i></i>","                            <b>涨停</b>","                        </div>",'                        <div class="gift-tit">￥88元</div>',"                    </div></label></li>","            </ul>",'        <div class="clearfloat"></div></div>','        <div class="gift-msgbox">','            <input class="sendgift-txt" value="" placeholder="主播分享的内容对我很有帮助，非常感谢！">',"        </div>",'        <div class="gift-btnline">','            <button class="btn sendgift-btn"> 赠送 </button>',"        </div>","    </div>","</div>"].join(""),a=0;$("#liveGift").length<1&&$("body").append(),$("#submitLine .inp-pack").append('<div class="call-giftbtn"> </div>'),$(document).on("click",".gift-wrap ul li",function(){$(this).addClass("active").siblings().removeClass("active")}).on("click",".call-giftbtn",function(){var e=$(this).offset();a=layer.open({type:1,title:"打赏",shade:.1,skin:"layer-gift",offset:[e.top-260+"px",e.left-220+"px"],area:["240px","280px"],content:i})}).on("click",".sendgift-btn",function(){var e,i,t;t=$.cookie("bindok"+window.Groupid),i=$("#liveGift .sendgift-txt").val()||"主播分享的内容对我很有帮助，非常感谢！",(e=$("#liveGift .gift-item input:checked").val())?"true"===t?c.submitGiftRward(i,e):"false"===t?(layer.close(a),d("EM_FUNC_USERREGISTER","")):c.checkUserBindMob(i,e,a):layer.msg("请选择打赏礼物！")})},checkUserBindMob:function(i,t,a){$.ajax({type:"get",timeout:ajaxTimeout,url:"http://pre.dsclient.emoney.cn/yqqapi/api/Present/GetEncryptMobileInfo?"+w,data:{},dataType:"json",success:function(e){switch(e.RetCode){case"0":$.cookie(window.Groupid+"bindok","true"),c.submitGiftRward(i,t);break;case"-1":layer.msg("您还未绑定过手机！");break;case"-2":$.cookie(window.Groupid+"bindok",!1),layer.close(a),layer.msg("您还未绑定过手机！")}},error:function(){},faild:function(){}})},submitGiftRward:function(e,i){var t=window.location.href.split("?"),a="",n=i,s=e,o=window.encodeURIComponent(f.LiveName),l=window.Groupid,r=$.cookie("celueliveCSId"),c=$.cookie("celueliveSGrpId"),d="";"celue_list"==window.liveSource?(d="",a=window.encodeURIComponent(t[0]+"?"+t[1])):"celue_article"==window.liveSource?(d=window.celueArticleLiveParam,t[1]=t[1].replace(/&*StrategyID=\d*/g,""),t[1]=t[1].replace(/&*LiveID=\d*/g,""),t[1]=t[1].replace(/&*NewsID=\d*/g,""),t[1]=t[1].replace(/^&*/g,""),a=Base.endoce(t[0]+"?"+d+"&"+t[1])):"celue_live"==window.liveSource&&(d="ClientStrategyId="+r+"&ClientStrategyGroupId="+c,t[1]=t[1].replace(/&*ClientStrategyId=\d*&ClientStrategyGroupId=\d*/g,""),a=Base.encode(t[0]+"?"+d+"&"+t[1])),window.top.location.href="http://pre.dsclient.emoney.cn/yqqapi/Pay/ChoosePayType?moneytype="+n+"&moneymsg="+s+"&livename="+o+"&lid="+l+"&refpage="+window.encodeURIComponent(a)}},window.pulldownLoad=function(){var e,i=!0;window.liveFrmNS1=null,window.liveFrmNS2=null,window.liveFrmNS3=null,liveFrmNS1=$("#iveNlPack2").niceScroll({cursorcolor:"#666",cursoropacitymax:.5,touchbehavior:!1,cursorwidth:"6px",cursorborder:"0",cursorborderradius:"8px",autohidemode:!1,overflowx:!0,enablescrollonselection:!1}),liveFrmNS1.scrollend(function(){liveFrmNS1.newscrolly>=liveFrmNS1.page.maxh-200&&i&&(i=!i,clearTimeout(e),e=setTimeout(function(){c.pulldownLoadZbPage(),i=!i},500))}),liveFrmNS2=$("#allQuestionPack").niceScroll({cursorcolor:"#666",cursoropacitymax:.5,touchbehavior:!1,cursorwidth:"6px",cursorborder:"0",cursorborderradius:"8px",autohidemode:!1,overflowx:!1,enablescrollonselection:!1}),liveFrmNS3=$("#myQuestionPack").niceScroll({cursorcolor:"#666",cursoropacitymax:.5,touchbehavior:!1,cursorwidth:"6px",cursorborder:"0",cursorborderradius:"8px",autohidemode:!1,overflowx:!1,enablescrollonselection:!1}),window.niceScrollGroups["expert-live"]={data:["#iveNlPack2","#allQuestionPack","#myQuestionPack"],niceScrolls:[liveFrmNS1,liveFrmNS2,liveFrmNS3]},window.iveNlPack2ns=$("#iveNlPack2").getNiceScroll(0),window.allQuestionPackns=$("#allQuestionPack").getNiceScroll(0),window.myQuestionPackns=$("#myQuestionPack").getNiceScroll(0)},c.Init(),$(function(){window.pulldownLoad()}),window.pulldownLoad(),setTimeout(function(){(e=document.createElement("Script")).src="http://img.tongji.emoney.cn/scripts/emoneyanalytics.js",$("body").append(e);var e,i=utils.GetQueryString("pid"),t=utils.GetQueryString("tid"),a=utils.GetQueryString("sid"),n=utils.GetQueryString("uid");""!=i&&null!=i||(i="0"),""!=t&&null!=t||(t="0"),""!=a&&null!=a||(a="0"),""!=n&&null!=n||(n="0"),(e=document.createElement("Script")).src="http://img.tongji.emoney.cn/scripts/emoneyanalyticsonlinetime.js",$("body").append(e),setTimeout(function(){$.EMoneyAnalyticsOnlineTime&&$.EMoneyAnalyticsOnlineTime.Init&&$.EMoneyAnalyticsOnlineTime.Init("DBF99A1E8F12642B1162ED6787B0A987","10094",i,t,a,n,window.Groupid)},500)},1e3),window.LoadMyQuestion=c.LoadMyQuestion,window.LoadQAPage=c.LoadQAPage,window.getLiveRoomInfo=c.getLiveRoomInfo,window.pickedFunc=function(){var e=c.dispose.getNowDate(),i=N.val(),t=i.slice(5,10);i==e?(D.text("今日直播"),G.removeClass("open")):(D.text(t+"直播"),G.addClass("open").html('<span class="total "></span>')),m=!1,window.lastUpdateTime=i,r=1,window.getLiveRoomInfo(),M.getNiceScroll(0).doScrollTop(2,.01),p=!0;var a=$("#liveListNav .active").eq(0).attr("data-target");"allQuestionPack"==a?window.LoadQAPage():"myQuestionPack"==a&&window.LoadMyQuestion()}}();