require.config({waitSeconds:0}),define(["jQuery","cors","utils","handlebars","jqueryform","json2","rules"],function(t,e,s,c,i,n,o){var a={config:{qaTpl:function(){return $("#qatpl")},qaList:function(){return $("#qalist")},resultTpl:function(){return $("#resulttpl")},resultList:function(){return $("#resultList")},tipsTpl:function(){return $("#tipstpl")},strategytpl:function(){return $("#strategytpl")},strateList:function(){return $("#strateList")},stocktpl:function(){return $("#stocktpl")},stockList:function(){return $("#stockList")},isTested:!($.support.cors=!0),strategyList:[],checkedItem:[],result:{},tips:{}},init:function(){var t=this;t.isTested(),t.loadingfn(),t.isRediretResult(),t.bindEvent()},bindEvent:function(){var c=this;$(document).on("click",".icontips",function(){$(this).parents(".question").siblings().find(".tipsbox").hide(),$(this).parents(".question").find(".tipsbox").toggle()}),$("#qabtn").on("click",function(){var n=[];c.config.qaList().find(".question").each(function(){var t=this.id,e=$(this).find(".custom-select"),i=e.find("option:selected"),s={qid:t,question:$.trim($(this).find(">dt").html()).replace(/：/g,""),answerid:e.val(),answer:i.text()};n.push(e.val()),"A"===t&&(c.config.result=dictionary[e.val()]),c.config.checkedItem.push(s)});for(var t=0;t<n.length;t++)for(var e=n[t],i=t;i<n.length;i++){var s=n[i];if(compareResult[e+s]){var o=s.substr(0,1);c.config.tips[o]||(c.config.tips[o]=[]),c.config.tips[o].push(compareResult[e+s])}}c.saveData({InvestTarget:c.config.checkedItem[0].answerid,InvestTargetDesc:c.config.checkedItem[0].answer,InvestTargetTip:c.config.tips.A?JSON.stringify(c.config.tips.A):"",ChooseStockReason:c.config.checkedItem[1].answerid,ChooseStockReasonDesc:c.config.checkedItem[1].answer,ChooseStockReasonTip:c.config.tips.B?JSON.stringify(c.config.tips.B):"",HoldStockTime:c.config.checkedItem[2].answerid,HoldStockTimeDesc:c.config.checkedItem[2].answer,HoldStockTimeTip:c.config.tips.C?JSON.stringify(c.config.tips.C):"",BuyStyle:c.config.checkedItem[3].answerid,BuyStyleDesc:c.config.checkedItem[3].answer,BuyStyleTip:c.config.tips.D?JSON.stringify(c.config.tips.D):"",Result:c.config.result.type,ResultDesc:c.config.result.desc})}),$("#btnsubmit").on("click",function(){c.config.isTested?c.closeWin():$(".step3").show().siblings().hide()}),$("#StockImage").on("change",function(){$("#formImg").submit()}),$("#formImg").ajaxForm({success:function(t){var e={};try{e=JSON.parse(t)}catch(s){"object"==typeof t&&(e=t)}if(0==e.RetCode&&e.Message&&e.Message.length){var i=e.Message;$("#spanNum").html("("+i.length+")"),$("#stockNum").html(i.length),$("#btnImport").removeClass("disabled"),$("#StockImage").val(""),c.handlerbarCompile(c.config.stocktpl(),c.config.stockList(),i),$(".step4").show().siblings().hide()}else c.config.stockList().empty().html("<div class='nonedata'>未识别股票，请换更清晰图片</div>"),$(".step4").show().siblings().hide()},error:function(t){$("#StockImage").val(""),console.log(t)}}),$("#btnSave").on("click",function(){var o=[];$("#strateList li.active").each(function(){var e=$(this),t=[],i=c.config.strategyList.find(function(t){return t.StrategyId===$.trim(e.attr("id").replace("sipt",""))});if(i.StockList.length)for(var s=0;s<i.StockList.length&&s<3;s++){var n=i.StockList[s];t.push(c.preStockcode(n.StockCode))}o.push(t.join(","))}),c.importStockLst("["+o.join(",")+"]"),c.closeWin()}),$("#btnImport").on("click",function(){var t=[];$("#stockList .active .checkbox").each(function(){t.push(c.preStockcode($(this).attr("data-val")))}),t.length?(t.reverse(),c.importStockLst("["+t.join(",")+"]"),c.closeWin()):$("#btnImport").addClass("disabled")}),$("#btnAsync").on("click",function(){c.anyncWin(),c.closeWin()}),$("#resetTest").on("click",function(){c.config.strategyList=[],c.config.checkedItem=[],c.config.result={},c.config.tips={},$(".tipsbox").hide(),$(".result-type,.result-desc").html(""),$("#qa1,#qa2,#qa3,#tips1,#tips2,#tips3").html(""),$(".question.active").removeClass("active"),$(".step1").show().siblings().hide()}),$("#strateList").on("click","li",function(){$(this).toggleClass("active")}),$("#stockList").on("click","li",function(){$(this).toggleClass("active");var t=$("#stockList .active .checkbox").length;$("#spanNum").html("("+t+")"),$("#stockNum").html(t),t?$("#btnImport").removeClass("disabled"):$("#btnImport").addClass("disabled")})},preStockcode:function(t){return"6"==t.substr(0,1)?"0"+t:"1"+t},anyncWin:function(){try{PC_JH("EM_FUNC_ONCE_SYNC_GOODS","")}catch(t){}},importStockLst:function(t){try{PC_JH("EM_FUNC_ADD_CLOUD_ZXG",t)}catch(e){}},saveStatusToClient:function(){try{PC_JH("EM_FUNC_ZXSTYLE_TEST_RESULT","")}catch(t){}},closeWin:function(){try{PC_JH("EM_FUNC_ZXSTYLE_TEST_CLOSE","")}catch(t){}},loadingfn:function(){$(document).ajaxStart(function(){$(".btn").addClass("disabled").prop("disabled",!0),$("#loading").show()}).ajaxStop(function(){$(".btn").removeClass("disabled").prop("disabled",!1),$("#loading").hide()}).ajaxError(function(t,e,i){}).ajaxComplete(function(t,e,i){$(".btn").removeClass("disabled").prop("disabled",!1),$("#loading").hide()})},isTested:function(){var e=this;$.ajax({url:window.gConfig.apiHost+"evaluation/getresult",type:"GET",timeout:5e3,data:{uid:s.GetQueryString("uid")},success:function(t){"{|*1*|}"==t&&(e.config.isTested=!0)},error:function(t,e,i){}})},loadData:function(e,s){$.ajax({url:window.gConfig.apiHost+"evaluation/getresult",type:"POST",timeout:5e3,dataType:"JSON",success:function(t){0==t.RetCode&&t.Message?"function"==typeof e&&e(t.Message):"function"==typeof s&&s(t.RetMsg)},error:function(t,e,i){"function"==typeof s&&s()}})},isRediretResult:function(){var i=this;"1"===s.GetQueryString("from")?i.loadData(function(t){var e=t;i.config.checkedItem=[{qid:e.InvestTarget.replace(/\d/g,""),answerid:e.InvestTarget,answer:e.InvestTargetDesc},{qid:e.ChooseStockReason.replace(/\d/g,""),answerid:e.ChooseStockReason,answer:e.ChooseStockReasonDesc},{qid:e.HoldStockTime.replace(/\d/g,""),answerid:e.HoldStockTime,answer:e.HoldStockTimeDesc},{qid:e.BuyStyle.replace(/\d/g,""),answerid:e.BuyStyle,answer:e.BuyStyleDesc}],i.config.tips={A:e.InvestTargetTip?JSON.parse(e.InvestTargetTip):"",B:e.ChooseStockReasonTip?JSON.parse(e.ChooseStockReasonTip):"",C:e.HoldStockTimeTip?JSON.parse(e.HoldStockTimeTip):"",D:e.BuyStyleTip?JSON.parse(e.BuyStyleTip):""},i.config.result=$.extend(!0,e,dictionary[e.InvestTarget]),i.loadTestResult(),$("#btnsubmit").hide(),$("#resetTest").addClass("resetbtn"),$(".step2").show().siblings().hide(),i.handlerbarHelper(),i.handlerbarCompile(i.config.qaTpl(),i.config.qaList(),QAlist)},function(t){$(".step1").show().siblings().hide(),i.handlerbarHelper(),i.handlerbarCompile(i.config.qaTpl(),i.config.qaList(),QAlist)}):(i.loadData(function(t){i.config.result=t,i.config.isTested=!0,i.handlerbarHelper(),i.handlerbarCompile(i.config.qaTpl(),i.config.qaList(),QAlist)},function(){i.handlerbarHelper(),i.handlerbarCompile(i.config.qaTpl(),i.config.qaList(),QAlist)}),$(".step1").show().siblings().hide())},loadTestResult:function(){var t=this,e=t.config.checkedItem;$(".result-type").html(t.config.result.type),$(".result-desc").html("<i>“</i> "+t.config.result.desc+"<i>”</i>"),$(".step2 .ts-header,.step3 .ts-header,.step4 .ts-header").css({"background-image":"url('"+t.config.result.imgsrc+"')"}),$("#qa1").html(e[0].answer),$("#qa2").html(e[1].answer),$("#qa3").html(e[2].answer+" "+e[3].answer);for(var i=0;i<t.config.checkedItem.length;i++){var s=t.config.checkedItem[i];if(t.config.tips[s.qid]){var n=t.config.tipsTpl().html(),o=c.compile(n)(t.config.tips[s.qid]);2===i||3===i?($("#tips3").find("dl").length&&(o=o.replace(/\<dt\>提示：<\/dt\>/g,"")),$("#tips3").append(o),$("#tips3").parent().addClass("active")):($("#tips"+(i+1)).empty().append(o),$("#tips"+(i+1)).parent().addClass("active"))}}$(".question.active .icontips:eq(0)").trigger("click")},requestStrategy:function(){var e=this;$.ajax({url:window.gConfig.apiHost+"evaluation/getstrategylist",type:"POST",timeout:5e3,dataType:"JSON",success:function(t){0==t.RetCode&&(e.config.strategyList=t.Message,e.handlerbarCompile(e.config.strategytpl(),e.config.strateList(),t.Message))},error:function(t,e,i){}})},handlerbarCompile:function(t,e,i){var s=t.html(),n=c.compile(s)(i);e.empty().append(n)},handlerbarHelper:function(t){var o=this;c.registerHelper("isSelected",function(t,e,i,s){if(!o.config.result||!o.config.result.InvestTarget)return e?"selected":"";var n=o.config.result;return n.InvestTarget&&n.InvestTargetDesc&&n.InvestTargetDesc===i?"selected":n.ChooseStockReason&&n.ChooseStockReasonDesc&&n.ChooseStockReasonDesc===i?"selected":n.HoldStockTime&&n.HoldStockTimeDesc&&n.HoldStockTimeDesc===i?"selected":n.BuyStyle&&n.BuyStyleDesc&&n.BuyStyleDesc===i?"selected":void 0})},saveData:function(t){var e=this;$.ajax({url:window.gConfig.apiHost+"evaluation/submitresult",type:"POST",timeout:5e3,dataType:"JSON",data:t,success:function(t){0==t.RetCode&&(e.requestStrategy(),e.saveStatusToClient(),e.loadTestResult(),$(".step2").show().siblings().hide(),e.config.isTested&&$("#btnsubmit,#resetTest").remove())},error:function(t,e,i){}})}};a.init(),window.closeWinSaveStatus=function(){a.saveStatusToClient()},$.EMoneyAnalytics().Init(myoptTjAppid,"zixuan_testing","")});