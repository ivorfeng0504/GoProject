define(["jquery","cors","layer","utils","handlebars","autocomplete","nicescroll","jqqqface","placeholder"],function(e,t,r,i,o,a,s,n,c){r.config({path:window.gConfig.staticPath+"static/libs/layer/"}),$.support.cors=!0;var l={curPageOpts:{currpage:0,pageSize:10,isFinished:!(window.SetMyZXGChanged=function(e){var t="";try{t=function a(e,t){try{return function a(){return window.external.EmObj}().EmFunc(e,t)}catch(i){}}("EM_FUNC_GET_MY_ZXG",e)}catch(i){}setTimeout(function(){""!==t&&t!==undefined?(t=t.replace(/\[/g,"").replace(/]/g,""),l.StockList=t,l.relationsInfoList(e),l.resetPageData(),$("#weiguList").empty(),r.msg("正在加载数据..."),l.getWeiGuList()):$("#newsList,#weiguList").addClass("no-info-lst").html('<div class="no-info">请添加自选股，追踪您的个股动态</div>')},300)})},StockList:"",EMSSOSTR:"",init:function(){var e=this,t=$.cookie("expertnews.uid");t&&"0"!=t?e.getUID=t:(e.getUID=i.GetQueryString("uid")||1,$.cookie("expertnews.uid",e.getUID)),e.EMSSOSTR=i.EMSSO(),e.getUID=t||i.GetQueryString("uid")||1,e.getAppId=1015004,e.handerbarsFormat(),e.scrollContent(),e.autoComplete(),window.SetMyZXGChanged(""),e.syncScrollState(),e.release(),e.celuevideoinfo(),e.autoInterval(),e.EM_HREF_JUMP(),e.qqFaceShow(),e.jumpToStockHQ(),$("[placeholder]").placeholder({customClass:"placeholder"})},jumpToStockHQ:function(){var t=this;$(document).on("click","[data-stockCode]",function(){var e=t.preStockcode($(this).attr("data-stockCode"));i.goThisStock(e)})},resetPageData:function(){l.curPageOpts.currpage=0,l.curPageOpts.isFinished=!1},handerbarsFormat:function(){o.registerHelper("renderTime",function(e){var t=new Date,a=t.getMonth()+1,i=a<=9?"0"+a:a,s=t.getFullYear()+"-"+i+"-"+t.getDate();return e=e==undefined||null==e||0==e.length?"":e.slice(0,10)==s?e.slice(11,16):e.slice(5,10)+" "+e.slice(11,16),new o.SafeString(e)}),o.registerHelper("renderTimed",function(e){var t=new Date,a=t.getMonth()+1,i=a<=9?"0"+a:a,s=t.getFullYear()+"-"+i+"-"+t.getDate();return e=e==undefined||null==e||0==e.length?"":e.slice(0,10)==s?e.slice(11,16):e.slice(5,7)+"/"+e.slice(8,10),new o.SafeString(e)})},autoInterval:function(){var e=this;setInterval(function(){e.resetPageData(),e.getWeiGuList(),e.celuevideoinfo()},6e4)},scrollContent:function(){var e=this;e.srcollBar=function(){$(".list").css("height",$(window).height()-$(".title:eq(0)").outerHeight()-1),$.each([".list"],function(e,t){0<$(t).length&&$(t).niceScroll({cursorcolor:"#666",cursoropacitymax:.5,touchbehavior:!1,cursorwidth:"6px",cursorborder:"0",cursorborderradius:"8px",autohidemode:!0})})},e.srcollBar(),$(window).on("resize",function(){e.srcollBar()})},autoComplete:function(){var a=[];$(EALists).each(function(e,t){"A股"==t._T&&a.push(t)}),$("#txt_add_stockname").autocomplete(a,{minChars:0,max:10,autoFill:!1,mustMatch:!1,matchContains:!0,scrollHeight:200,formatItem:function(e){return e._C+" "+e._N},formatMatch:function(e){return e._C+" "+e._S+" "+e._N},formatResult:function(e){return e._N}})},preStockcode:function(e){return"6"==e.substr(0,1)?"0"+e:"1"+e},release:function(){var n=this;n.$sayBtn=$("#sayBtn"),n.sayBox=$("#sayBox");var e=$("#release"),t=$("#close");n.$stock=$("#txt_add_stockname"),n.$content=$("#content"),n.$sayBtn.on("click",function(){$(this);n.$stock.val(""),n.$content.val(""),n.sayBox.addClass("open")}),e.on("click",function(){$(this);var a,i=$.trim(n.$stock.val()),e=$.trim(n.$content.val()),s=!1,t=!0;if(i)if($(EALists).each(function(e,t){t._N==i&&(a=t._C,s=!0)}),s){if(!e)setTimeout(function(){r.msg("请输入对股票的看法",{offset:["50%","45%"]})},200)}else setTimeout(function(){r.msg("请输入正确股票代码",{offset:["50%","45%"]})},200);else if(!i&&e)setTimeout(function(){r.msg("请输入股票代码",{offset:["50%","45%"]})},200);if(!i&&!e)setTimeout(function(){r.msg("请输入股票代码与看法",{offset:["50%","45%"]})},200);a&&i&&e&&t&&$.ajax({url:window.gConfig.apiHost+"stocktalk/addstocktalk",type:"POST",timeout:5e3,dataType:"JSON",data:{StockCode:a,StockName:i,Content:e},success:function(e){if(0==e.RetCode){t=!1,n.sayBox.removeClass("open"),n.$sayBtn.removeClass("close");setTimeout(function(){r.msg("消息已发送",{offset:["50%","45%"]})},200)}else r.msg(e.RetMsg,{offset:["50%","45%"]})},error:function(e,t,a){}})}),t.on("click",function(){$(this);n.sayBox.removeClass("open")})},relationsInfoList:function(e){$("#newsList").addClass("no-info-list").html('<div class="no-info">请添加自选股，追踪您的个股动态</div>');var i=["{{#each Message}}",'<li class="news-item" clickkey="xiangguanzixun" clickdata="{{Id}}|relatedArticle" clickremark="" type=""><a class="news-item-link" href="#" data-ahref="'+pagerouter.articleZixun+'?newsid={{Id}}&source=cloud" data-title="{{ArticleTitle}}"><i class="icon-1">&#xe637;</i>{{ArticleTitle}}</a><span class="time">{{renderTimed PublishTime}}</span></li>',"{{/each}}"].join("");$.ajax({url:window.gConfig.apiHost+"stocknews/getstocknews",type:"POST",timeout:5e3,dataType:"JSON",data:{StockList:this.StockList},success:function(e){if(0==e.RetCode&&e.Message&&e.Message.length){var t=$("#newsList"),a=o.compile(i)(e);t.removeClass("no-info-list").html(a)}else $("#newsList").addClass("no-info-list").html('<div class="no-info">请添加自选股，追踪您的个股动态</div>')},error:function(e,t,a){$("#newsList").addClass("no-info-list").html('<div class="no-info">请添加自选股，追踪您的个股动态</div>')}})},getWeiGuList:function(s){$("#weiguList").removeClass("no-info-cnt").find(".no-info").remove();var n=this;o.registerHelper("subStr",function(e,t){return e==undefined||null==e||0==e.length?time="":e.length>t&&(e=$.trim(e).substr(0,t)+"..."),new o.SafeString(e)});var c=["{{#each Message}}",'<li class="weigu-item" data-id="{{StockTalkId}}">','   <div class="desc">','       <span class="name">{{NickName}}</span>','       <span class="time">{{renderTime CreateTime}}</span>','       <span class="like-box"><i class="ask-answer icon-1" clickkey="weiguba" clickdata="{{StockTalkId}}|home" clickremark="">&#xe62c;</i><i class="like-icon icon-1" data-newsid="{{StockTalkId}}">&#xe61b;</i><span class="like" id="like{{StockTalkId}}">888</span></span>','               <div class="clearfloat"></div>',"   </div>",'   <div class="content-box">','<i class="pointer-angle"><em></em></i>','        <div class="intro">','              <span class="name"><span class="stockname" data-stockCode="{{StockCode}}">{{StockName}}</span></span>',"         </div>",'         <div class="content">{{{Content}}}</div>',"   </div>","</li>","{{/each}}"].join("");$.ajax({url:window.gConfig.apiHost+"stocktalk/getstocktalkbypage",type:"POST",timeout:5e3,dataType:"JSON",data:{StockCodeList:n.StockList,PageIndex:n.curPageOpts.currpage,PageSize:n.curPageOpts.pageSize},beforeSend:function(){1===s&&r.msg("正在加载数据...")},success:function(e){r.closeAll();var t=$("#weiguList");if(0==e.RetCode&&e.Message&&e.Message.length){var a=o.compile(c)(e);1===s?($(".pack",t).length||t.append("<div class='pack'></div>"),$("#weiguPage"+n.curPageOpts.currpage).length||$(".pack",t).append('<ul id="weiguPage'+n.curPageOpts.currpage+'">'+a+"</ul>")):(t.prepend("<div class='pack'></div>"),$(".pack",t).eq(0).append('<ul id="weiguPage'+n.curPageOpts.currpage+'">'+a+"</ul>"),t.find(".pack").eq(1).remove());var i=$("#weiguPage"+n.curPageOpts.currpage);n.clickLike(i),n.$content=$("#content"),$(".ask-answer",i).on("click",function(){var e=$(this),t=e.parents(".weigu-item").find(".stockname").text();e.parents(".weigu-item").find(".stockname").attr("data-stockCode");n.$stock.val(t),n.$content.val(""),n.autoComplete(),n.sayBox.addClass("open")})}else 0==e.RetCode?(n.curPageOpts.isFinished=!0,t.find("ul").length||t.addClass("no-info-list").html('<div class="no-info">暂无数据显示</div>')):t.addClass("no-info-list").html('<div class="no-info">暂无数据显示</div>')},error:function(e,t,a){$weiguList.addClass("no-info-list").html('<div class="no-info">暂无数据显示</div>')}})},syncScrollState:function(){var i=this;window.pulldownLoad=function(){var e,t=null,a=!0;$(function(){(t=$("#WeiguScroll").getNiceScroll(0)).jqbind("#WeiguScroll","scroll",function(){i.curPageOpts.isFinished||t.newscrolly==t.page.maxh&&a&&(a=!a,clearTimeout(e),i.curPageOpts.currpage=parseInt(i.curPageOpts.currpage)+1,e=setTimeout(function(){i.getWeiGuList(1),a=!a},500))})})},window.pulldownLoad()},clickLike:function(s){var t=this,a=[];$(".like",s).each(function(){var e=$(this).parents("li").attr("data-id");a.push({uid:t.getUID,newsId:e,appId:t.getAppId})}),$.ajax({type:"post",contentType:"text/plain",dataType:"json",url:window.gConfig.likeListDataServer,data:JSON.stringify(a),success:function(i,e){i.isSucess?$(".like",s).each(function(){for(var e=$(this),t=e.parents("li").attr("data-id"),a=0;a<i.message.length;a++)i.message[a].newsId==t&&(1==i.message[a].liked&&(e.siblings("i.like-icon").html("&#xe66b;"),e.siblings("i.like-icon").addClass("liked")),e.text(i.message[a].likes))}):$(".like",s).each(function(){$(this).text(0)})},error:function(e,t,a){$(".like",s).each(function(){$(this).text(0)})}}),i.thumbUP(".like-box .like-icon",t.getUID,t.getAppId,s)},celuevideoinfo:function(){var i,s=$("#strategyListShow"),e=["{{#each Message}}",'<li class="strategy-item">',"{{#isValid NewsType}}",'<div class="si-p">','<a class="photo-link" clickkey="celuewenzhang" clickdata="{{StrategyID}}|zhuanjiacelue_list" clickremark="" href="javascript:;" data-ahref="'+pagerouter.zhuanjiacelueList+"?StrategyID={{StrategyID}}&LiveID={{LiveId}}&ColumnID="+confColumnID+'&currpage=1&pageSize=3"> {{#if StrategyImg}}','<img class="photo" src="{{StrategyImg}}" /> {{else}}','<img class="photo" src="'+defaultAvatar+'" /> {{/if}}</a>','<div class="brief-intro">','<a class="name" href="javascript:;" clickkey="celuewenzhang" clickdata="{{StrategyID}}|zhuanjiacelue_list" clickremark="" data-ahref="'+pagerouter.zhuanjiacelueList+"?StrategyID={{StrategyID}}&LiveID={{LiveId}}&ColumnID="+confColumnID+'&currpage=1&pageSize=3">{{ StrategyName }}</a>','<span class="time"><span>{{renderTime SendTime}}</span> <span class="live">正在直播</span></span>',"</div>",'<a class="kankan" href="javascript:;" clickkey="celuewenzhang" clickdata="{{StrategyID}}" clickremark="" data-ahref="'+pagerouter.zhuanjiacelueList+"?StrategyID={{StrategyID}}&LiveID={{LiveId}}&ColumnID="+confColumnID+'&source=ll&currpage=1&pageSize=3">看直播</a>','<div class="clearfloat"></div>',"</div>",'<div class="content">','    <a href="javascript:;" clickkey="celuewenzhang" clickdata="{{StrategyID}}" clickremark="" data-ahref="'+pagerouter.zhuanjiacelueList+"?StrategyID={{StrategyID}}&LiveID={{LiveId}}&ColumnID="+confColumnID+'&source=ll&currpage=1&pageSize=3">',"        {{removeHTMLtags Summary}}","     </a>"," </div>","{{/isValid}}","{{#isPoint NewsType}}",'<div class="si-p">','<a class="photo-link" href="javascript:;" clickkey="celuewenzhang" clickdata="{{StrategyID}}|zhuanjiacelue_list" clickremark="" data-ahref="'+pagerouter.zhuanjiacelueList+"?StrategyID={{StrategyID}}&LiveID={{LiveId}}&ColumnID="+confColumnID+'&currpage=1&pageSize=3"> {{#if StrategyImg}}','<img class="photo" src="{{StrategyImg}}" /> {{else}}','<img class="photo" src="'+defaultAvatar+'" /> {{/if}}</a>','<div class="brief-intro">','<a class="name" href="javascript:;" clickkey="celuewenzhang" clickdata="{{StrategyID}}|zhuanjiacelue_list" clickremark="" data-ahref="'+pagerouter.zhuanjiacelueList+"?StrategyID={{StrategyID}}&LiveID={{LiveId}}&ColumnID="+confColumnID+'&currpage=1&pageSize=3">{{ StrategyName }}</a>','<span class="time"><span>{{renderTime SendTime }}</span> <span class="live"> 发表了新观点 </span></span>',"</div>",'<a class="kankan" href="javascript:;" clickkey="celuewenzhang" clickdata="{{StrategyID}}|celue_article" clickremark="" data-ahref="'+pagerouter.celueArticle+"?StrategyID={{StrategyID}}&LiveID={{LiveId}}&NewsID={{NewsID}}&ColumnID="+confColumnID+'&source=ll&currpage=1&pageSize=3">读文章</a>','<div class="clearfloat"></div>',"</div>",'<div class="content">','   <a href="javascript:;" clickkey="celuewenzhang" clickdata="{{StrategyID}}|celue_article" clickremark="" data-ahref="'+pagerouter.celueArticle+"?StrategyID={{StrategyID}}&LiveID={{LiveId}}&NewsID={{NewsID}}&ColumnID="+confColumnID+'&source=ll&currpage=1&pageSize=3">',"         {{removeHTMLtags Summary}}","   </a>"," </div>","{{/isPoint}}","</li>","{{/each}}"].join("");o.registerHelper("isValid",function(e,t){return 2==e?t.inverse(this):t.fn(this)}),o.registerHelper("isPoint",function(e,t){return 1==e?t.inverse(this):t.fn(this)}),o.registerHelper("removeHTMLtags",function(e){var t;return e==undefined||null==e?timestr="":t=$("<div>"+e+"</div>").text(),new o.SafeString(t)}),o.registerHelper("renderDateTime",function(e){var t;return t=e==undefined||null==e||0==e.length?"":(e=e.replace("T"," ")).substr(11,5),new o.SafeString(t)}),o.registerHelper("BigCastorSummary",function(e){var t,a=$("<div>"+e+"</div>").text();return t=a.length>(a=a.slice(0,50)).length?"…":"",new o.SafeString(a+t)});i=o.compile(e),$.ajax({type:"get",url:window.gConfig.apiHost+"strategy/getfocusstrategylist",contentType:"application/json",type:"GET",timeout:5e3,dataType:"JSON",data:{UID:this.getUID},success:function(e,t){if("success"===t&&0==e.RetCode){e.Message=e.Message.filter(function(e){return 0!=e.StrategyID});var a=i(e);s.removeClass("no-info-list").html(a),"FALSE"===e.RetMsg.toUpperCase()&&s.prepend('<div class="no-info1">未关注策略，为您推荐热门策略动态</div>').append('<div class="loadmore"><a href="javascript:void(0);" clickkey="celuewenzhang" clickdata="more|home" clickremark="" id="loadMore">更多策略>></a></div>')}else s.addClass("no-info-list").html('<div class="no-info">未关注策略，为您推荐热门策略动态</div>')},error:function(){s.addClass("no-info-list").html('<div class="no-info">未关注策略，为您推荐热门策略动态</div>')}})},EM_PC_JSBRIDGE:function(e,t){!function a(e,t){try{return function a(){return window.external.EmObj}().EmFunc(e,t)}catch(i){}}(e,t)},EM_HREF_JUMP:function(){var c=this;$("#strategyListShow").on("click","a[data-ahref]",function(){if(!$(this).hasClass("disabled")){$(this).addClass("disabled");var e=$(this).attr("data-ahref");try{c.EM_PC_JSBRIDGE("EM_FUNC_ZNTG_CLZL",e)}catch(t){}$(this).removeClass("disabled")}}),$(document).on("click","#loadMore",function(){if(!$(this).hasClass("disabled")){$(this).addClass("disabled");var e=pagerouter.expertHome;try{c.EM_PC_JSBRIDGE("EM_FUNC_ZNTG_CLZL",e)}catch(t){}$(this).removeClass("disabled")}}),$("#newsList").on("dblclick",".news-item",function(){var e=$(this);if(e.addClass("actived"),!e.hasClass("disabled")){e.addClass("disabled");var t=e.find(".news-item-link"),a=t.attr("data-ahref"),i=t.attr("data-title"),s=a+"&";try{c.EM_PC_JSBRIDGE("EM_FUNC_GOODS_NEWSINFO","{|*"+i+"*|}{|*"+s+"*|}")}catch(n){}e.removeClass("disabled")}})},qqFaceShow:function(){$("#qqEmotion").qqFace({assign:"content",face_count:36,path:"http://static.emoney.cn/live/Scripts/xheditor/xheditor_emot/newface/default/"})}};l.init(),$.EMoneyAnalytics().Init(myoptTjAppid,"zixuan","")});