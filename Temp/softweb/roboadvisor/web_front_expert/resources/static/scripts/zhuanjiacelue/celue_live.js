define(["jquery","cors","utils","layer","nicescroll"],function(C,e,a,r,t){r.config({path:window.gConfig.staticPath+"static/libs/layer/"}),C.support.cors=!0;var n={UID:"",appIDlive:window.gConfig.appIDlive,curClientStrategyId:null,curClientStrategyGroupId:null,isChangeLiveroom:!0,curPageOpts:{NewsID:0,ColumnID:16,StrategyID:0,currpage:1,pageSize:5,LiveID:0,ExpertLiveroom:"http://yqq.emoney.cn/Live/UserLive?lid=93",isbg:!1,newsidzan:[],zanparams:[]},init:function(){var e=this,t=a.GetQueryString("ClientStrategyId"),i=a.GetQueryString("ClientStrategyGroupId");e.UID=C.cookie("expertnews.uid")||a.GetQueryString("uid"),C.support.cors=!0,a.EMSSO(),e.EM_HREF_JUMP(),e.resetLiveContboxSize(),a.thumbUP(".like",e.UID,e.appIDlive,"#liveLikeCnt"),n.EM_CLIENT_INTERACT(),t&&i&&n.CIENT_CALL_FUNCTION(i,t)},CIENT_CALL_FUNCTION:function(e,t){var i=this;e&&t&&(i.isChangeLiveroom=!1,i.curClientStrategyGroupId==e?i.isChangeLiveroom=!1:i.isChangeLiveroom=!0,i.curClientStrategyGroupId=e,i.curClientStrategyId=t,1==i.isChangeLiveroom&&i.LiveroomInfoFrameShow(i.curClientStrategyId),i.strategyLatestListShow())},loadClickLike:function(e){var t=new Date,i=(t.getFullYear(),("00"+(t.getMonth()+1)).slice(-2),("00"+t.getDate()).slice(-2),'<span class="vt-cell like" id="like'+e+'" data-channelid="'+e+'"><i class="icon-1" id="likeicon'+e+'">&#xe61b;</i><span class="liked" id="liked'+e+'"> </span></span >');C("#liveLikeCnt").html(i),this.clickLike(this.UID,e,this.appLiveID)},clickLike:function(e,a,t){C.ajax({type:"get",contentType:"text/plain",dataType:"json",url:window.gConfig.likeDataServer,data:{uid:e,newsId:a,appId:t},success:function(e,t){e.isSucess?C("#like"+a).attr("data-channelid")==a&&(C("#liked"+a).text(e.message.likes),!0===e.message.liked?(C("#likeicon"+a).html("&#xe66b;"),C("#like"+a).addClass("liked")):(C("#likeicon"+a).html("&#xe61b;"),C("#like"+a).removeClass("liked"))):(C("#likeicon"+a).html("&#xe61b;"),C("#like"+a).removeClass("liked"))},error:function(e,t,i){C("#likeicon"+a).html("&#xe61b;"),C("#like"+a).removeClass("liked")}})},resetLiveContboxSize:function(){var e=this;e.reCountLiveCntSize(),C(window).resize(function(){e.reCountLiveCntSize()})},reCountLiveCntSize:function(){C("#liveiFrame").height(C(window).height()-C("#mainBox").height())},strategyLatestListShow:function(){var e=C("#latestStrategyNews"),t=C("#latestStrategyVideoNews"),s=C("[data-ahref]",e),l=C(".strategyNews-Summary",e),g=C("[data-ahref]",t),c=C(".svideoNews-Summary",t),u=(C("#gotoExpliveroom"),this.curClientStrategyId),d=this.curClientStrategyGroupId,y=C("#noInfo");C.ajax({url:window.gConfig.apiHost+"strategyservice/getindexstrategynewsv3",type:"POST",timeout:1e4,dataType:"JSON",data:{ClientStrategyGroupId:d,ClientStrategyId:u},beforeSend:function(){},success:function(e){var t,i,a,r,n,o;y.remove(),0==e.RetCode&&e.Message?(n=1==e.Message.StrategyNewsIsGroup?1:0,e.Message.StrategyNews?(t=C("<div>"+(e.Message.StrategyNews.Summary||e.Message.StrategyNews.Title||"策略原理核心价值！")+"</div>").text(),l.text(t),a="&NewsID="+e.Message.StrategyNews.ID):(l.text("策略原理核心价值！"),a=""),o=1==e.Message.StrategyVideoNewsIsGroup?1:0,e.Message.StrategyVideoNews?(i=C("<div>"+(e.Message.StrategyVideoNews.Summary||e.Message.StrategyVideoNews.Title||"课程核心介绍")+"</div>").text(),c.text(i),r="&videoID="+e.Message.StrategyVideoNews.ID):(c.text("课程核心介绍"),r=""),s.attr("data-ahref",pagerouter.celueReading+"?ClientStrategyGroupId="+d+"&ClientStrategyID="+u+a+"&isGroup="+n),g.attr("data-ahref",pagerouter.celueVideo+"?ClientStrategyGroupId="+d+"&ClientStrategyID="+u+r+"&isGroup="+o)):(l.text("策略原理核心价值！"),a="",c.text("课程核心介绍"),r="",s.attr("data-ahref",pagerouter.celueReading+"?ClientStrategyGroupId="+d+"&ClientStrategyID="+u),g.attr("data-ahref",pagerouter.celueVideo+"?ClientStrategyGroupId="+d+"&ClientStrategyID="+u))},error:function(e,t,i){}})},LiveroomInfoFrameShow:function(t){var i=this,e={ClientStrategyId:t};C.ajax({url:window.gConfig.apiHost+"strategyservice/getliveroom",type:"POST",data:e,success:function(e){0==e.RetCode&&e.Message?(i.loadClickLike(e.Message),i.LiveId=e.Message,C("#liveiFrame").attr("src",window.gConfig.zyapiyqq+"yqqexpert/liveFrame.html?LiveID="+e.Message+a.EMSSO())):e.RetCode<0&&r.msg("未匹配到相关的直播室信息"+t)}})},EM_HREF_JUMP:function(){function i(e,t){try{return function i(){return window.external.EmObj}().EmFunc(e,t)}catch(a){}}C("#cltNewsTop").on("click","a[data-ahref]",function(){var e=C(this).attr("data-ahref");try{i("EM_FUNC_OPEN_STRATEGY_STUDY",e)}catch(t){}})},EM_CLIENT_INTERACT:function(){var i=this;window.fillStrategyDataById=function(e,t){i.CIENT_CALL_FUNCTION(e,t)},function(){function i(e,t){try{return function i(){return window.external.EmObj}().EmFunc(e,t)}catch(a){}}!function e(){var e;try{e=(e=(e=(e=i("EM_FUNC_GET_STATEGY_INFO","")).replace(/\[/,"")).replace(/\]/,"")).split(","),fillStrategyDataById(e[0],e[1])}catch(t){}}()}()}};n.init()});