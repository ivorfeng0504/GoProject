define(["jquery","cors","utils","layer","handlebars","nicescroll"],function(g,e,u,l,o,t){l.config({path:window.gConfig.staticPath+"static/libs/layer/"});var p={layerindex:0,curPageOpts:{NewsID:0,ColumnID:16,StrategyID:0,LiveID:0,currpage:1,pageSize:10,LiveID:0,isg:!0},init:function(){var i=this;u.appendSSO(),g.support.cors=!0,window.layerIndex=l.load(2,{shade:.01}),g.each(["#medialistScroll","#medialistScroll2","#iveNlPack","#iveNlPack2","#acScrollbox","#yaowenNlPack","#iveYwNlPack"],function(e,t){0<g(t).length&&g(t).niceScroll({cursorcolor:"#666",cursoropacitymax:.5,touchbehavior:!1,cursorwidth:"6px",cursorborder:"0",cursorborderradius:"8px",autohidemode:!1})}),i.StrategyList(16),i.hotArticlesList(),i.hotBigCastor(),window.pulldownLoad=function(){var e,t=null,a=!0;g(function(){(t=g("#medialistScroll").getNiceScroll(0)).jqbind("#medialistScroll","scroll",function(){t.newscrolly==t.page.maxh&&a&&(a=!a,clearTimeout(e),i.curPageOpts.currpage+=1,e=setTimeout(function(){i.StrategyList(),a=!a},500))})})},window.pulldownLoad()},strategyOpts:{ColumnID:16,StrategyID:0,LiveID:0,currpage:1,pageSize:20},StrategyList:function(e,t,a,i){var n=this,s=["<div data-page='{{ currpage }}'>","{{#each Message}}","<div class='item section'>",'<div class="item-media"><a class="alink" href="'+pagerouter.zhuanjiacelueList+"?NewsID={{NewsInfo.ID}}&LiveID={{StrategyInfo.LiveID}}&ColumnID="+n.curPageOpts.ColumnID+"&StrategyID={{StrategyInfo.ID}}&currpage="+n.curPageOpts.currpage+"&pageSize="+n.curPageOpts.pageSize+'"><img src="{{rendernewsimg NewsInfo.CoverImg }}" alt=""></a></div>','<div class="item-content">','\t<div class="ic-iner">','\t\t<h3 class="ic-title"><a class="alink" href="'+pagerouter.zhuanjiacelueArticle+"?NewsID={{NewsInfo.ID}}&LiveID={{StrategyInfo.LiveID}}&ColumnID="+n.curPageOpts.ColumnID+"&StrategyID=0&currpage="+n.curPageOpts.currpage+"&pageSize="+n.curPageOpts.pageSize+u.EMSSO()+'">{{ NewsInfo.Title }}</a></h3>','<div class="ic-txt"><a class="alink" href="'+pagerouter.zhuanjiacelueArticle+"?NewsID={{NewsInfo.ID}}&LiveID={{StrategyInfo.LiveID}}&ColumnID="+n.curPageOpts.ColumnID+"&StrategyID=0&currpage="+n.curPageOpts.currpage+"&pageSize="+n.curPageOpts.pageSize+u.EMSSO()+'">{{rendernewsSummary NewsInfo.Summary NewsInfo.NewsContent}}</a></div>','<div class="ic-footer">','\t<div class="pull-right">','\t\t<b class="clickbtn-like" data-chanelid="{{NewsInfo.ID}}"><i class="icon-1">&#xe61b;</i><span class="clickLikes"> </span></b>','\t\t<b>　<i class="icon-1">&#xe602;</i> {{NewsInfo.ClickNum}}</b>',"\t</div>","\t<div><a class='alink' href='"+pagerouter.zhuanjiacelueList+"?NewsID={{NewsInfo.ID}}&LiveID={{StrategyInfo.LiveID}}&ColumnID="+n.curPageOpts.ColumnID+"&StrategyID={{StrategyInfo.ID}}&currpage="+n.curPageOpts.currpage+"&pageSize="+n.curPageOpts.pageSize+u.EMSSO()+"'><span>{{ StrategyInfo.StrategyName }} | <span class='vnum'>投顾编号：{{ StrategyInfo.StrategyTGNo }}</span></span></a>","   </div>","</div>","</div>","</div><div class='clearfloat'></div></div>","{{/each}}","</div>"].join("");o.registerHelper("renderTime",function(e){return e=e==undefined||null==e||0==e.length?"":e.substr(0,10),new o.SafeString(e)}),o.registerHelper("rendernewsimg",function(e){return""!=e&&null!=e&&e!=undefined||(e=window.gConfig.staticPath+"static/images/default1.png"),new o.SafeString(e)}),o.registerHelper("rendernewsSummary",function(e,t){var a="",i="";return e==undefined||null==e||""==e?e=" - ":(i=65<(a=g("<div>"+e+"</div>").text()).length?"…":"",e=a.slice(0,65)+i),new o.SafeString(e)});var c=o.compile(s);g.ajax({url:window.gConfig.apiHost+"strategy/GetStrategyNewsList",contentType:"application/json",type:"GET",timeout:ajaxTimeout,dataType:"JSON",data:{ColumnID:16,StrategyID:0,currpage:p.curPageOpts.currpage,pageSize:p.curPageOpts.pageSize},beforeSend:function(){},success:function(e){if(0==e.RetCode&&e.Message&&0<e.Message.length){g.extend(e,{currpage:p.curPageOpts.currpage});var t=c(e);1==p.curPageOpts.currpage?g("#tacticsList").html(t):g("#tacticsList").append(t),l.close(window.layerIndex),1<n.curPageOpts.currpage&&l.tips("底部有新的内容加载","#medialistScroll",{offset:["400px","450px"],tips:[2,"#cb4b4b"]});var a,i=u.getUID(),s=appIDnewsinfo,r=[];g.each(g("#tacticsList [data-page="+p.curPageOpts.currpage+"] .section"),function(e,t){a=g(".clickbtn-like",t).data("chanelid"),r.push({newsId:a,uid:i,appId:s})}),n.getLikesCollect(r)}else p.curPageOpts.isg&&l.tips("已加载全部","#medialistScroll",{offset:["400px","450px"],tips:[2,"#cb4b4b"]}),p.curPageOpts.isg=!1},error:function(e,t,a){}})},getLikesCollect:function(e){var r={};g.ajax({type:"get",timeout:ajaxTimeout,contentType:"text/plain",dataType:"jsonp",url:window.gConfig.likeListDataServerJsonp,data:{jsondata:JSON.stringify(e)},success:function(a){var i,s;a.isSucess&&(g.each(a.message,function(e,t){r[a.message[e].newsId]={liked:a.message[e].liked,likes:a.message[e].likes}}),g.each(g("#tacticsList [data-page="+p.curPageOpts.currpage+"] .section"),function(e,t){i=g(".clickbtn-like",t),s=i.attr("data-chanelid"),g(".clickLikes",i).html(r[s].likes)}))}})},getLikesnum:function(e,t,a,i){var s=t,r=a,n=i,c=g(".clickbtn-like"),l=(g(".icon-1",c),e),o={uid:s,newsId:r,appId:n};u.objToQuery(o);g.ajax({type:"get",timeout:ajaxTimeout,url:window.gConfig.likeDataServerJsonp,data:o,dataType:"jsonp",success:function(e,t){"success"===t&&e.isSucess&&function a(e){l.html(e.message.likes)}(e)}})},hotArticlesList:function(){var e=['<ul class="ive-nl-cnt">',"{{#each Message}}",'    <li>  <a class="alink" href="'+pagerouter.zhuanjiacelueArticle+"?NewsID={{ ID }}&ColumnID="+this.strategyOpts.ColumnID+"&StrategyID={{ExpertStrategyID}}&currpage="+this.strategyOpts.currpage+"&pageSize="+this.strategyOpts.pageSize+u.EMSSO()+'"><i class="icon-1">&#xe637;</i>{{ Title }}</a>',"    </li>","{{/each}}","</ul>"].join("");o.registerHelper("renderTime",function(e){return e=e==undefined||null==e||0==e.length?"":e.substr(0,10),new o.SafeString(e)});var a=o.compile(e);g.get(window.gConfig.apiHost+"strategy/GetHotStrategyNewsList_Top10",{ColumnID:16,StrategyID:0,currpage:1,pageSize:10},function(e){if(0==e.RetCode&&0<e.Message.length){var t=a(e);g("#iveNlPack").html(t)}})},hotBigCastor:function(){var e=['<div class="medialist">',"{{#each Data}}",'\t<div class="item">','\t\t<a class="alink" href="'+pagerouter.yqqUserLive+"?lid={{ Id }}&"+u.EMSSO()+'" target="_blank"><div class="item-heading">','\t\t\t<div class="media pull-left">','\t\t\t\t<img src="{{ LiveImg }}" alt="">',"\t\t\t</div>","\t\t</div></a>",'\t\t<div class="item-content">','\t\t\t<div class="pull-right">','\t\t\t\t<i class="icon-1">&#xe635;</i>',"\t\t\t\t<span> {{ FansNum }} </span>","\t\t\t</div>","\t\t\t<h4>",'\t\t\t<a class="alink" href="'+pagerouter.yqqUserLive+"?lid={{ Id }}&"+u.EMSSO()+'" target="_blank"> {{ LiveName }} </a>',"\t\t\t</h4>","       {{#unless @index}}",'\t\t\t<div class="text"><a class="alink" href="'+pagerouter.yqqUserLive+"?lid={{ Id }}&"+u.EMSSO()+'" target="_blank">',"\t\t\t\t {{ LiveIntro }}","\t\t\t</a></div>","       {{/unless}}","\t\t</div>",'\t<div class="clearfloat"></div></div>',"{{/each}}","</div>"].join("");o.registerHelper("isfirst",function(e){return v1==v2?options.fn(this):options.inverse(this)});var r=o.compile(e);g.get(window.gConfig.apiHost+"yqq/getliveroomlist",{ColumnID:16,StrategyID:0,currpage:1,pageSize:10},function(e){var t,a,i,s;"0"==(e=JSON.parse(e)).RetCode&&0<e.Data.length&&(e.Data=e.Data.sort((s="FansNum",function(e,t){var a=e[s];return t[s]-a})),i=960<g(window).width()?5:3,t={Data:e.Data.slice(0,i)},a=r(t),g("#iveNlPack1").html(a))})}};p.init()});