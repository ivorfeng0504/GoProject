require(["jquery","utils","cors","handlebars","idangerousSwiper","nicescroll"],function(d,t,e,c,i,a){var s={nonedataHtml:'<div class="no-info">暂无数据显示，请稍后重试</div>',init:function(){var e=this;t.EMSSO(),t.appendSSO(),e.relationData={},e.topicID=t.GetQueryString("topicId"),e.scrollbar(),e.getSwiperData(),d("#relationsStockList").on("click",".name",function(){var e=d(this);t.goThisStock(e.attr("data-stockCode"))}),d("#relation-list").on("click",".item",function(){var e=d(this);t.goThisStock(e.attr("data-stockCode"))})},buildThemesSwiper:function(){var a=this,e=d(".swiper-wrapper"),n=d(".item",e),r=n.length,s=d(".arrow-right"),o=d(".arrow-left"),l=new Swiper(".swiper-container",{grabCursor:!0,paginationClickable:!1,slidesPerView:5,loop:!1,onlyExternal:!0,autoResize:!0,roundLengths:!0,resizeReInit:!0});5<r&&(o.addClass("open"),s.addClass("open")),0==a.topicId&&o.addClass("disable"),l.swipeTo(a.topicId),d("#slide .item").each(function(){var e=d(this);e.attr("data-topicid")==a.topicID&&e.addClass("swiper-slide-active").siblings().removeClass("swiper-slide-active")}),o.on("click",function(e){e.preventDefault();var t,i=d(".swiper-slide-active").index();1==i?(d(this).addClass("disable"),s.removeClass("disable")):1<i&&(d(this).removeClass("disable"),s.removeClass("disable")),0<i&&(t=n.eq(i-1).attr("data-topicId"),l.swipeTo(i-1),n.eq(i-1).addClass("swiper-slide-active").siblings().removeClass("swiper-slide-active"),a.slidedData(t),a.relationInfo(t),d("#relation-part").getNiceScroll(0).doScrollTop(0,.01))}),s.on("click",function(e){e.preventDefault();var t=d(this).attr("data-topicId"),i=d(".swiper-slide-active").index();i==r-2?(d(this).addClass("disable"),o.removeClass("disable")):i<r-2&&(d(this).removeClass("disable"),o.removeClass("disable")),i<=r-2&&(t=n.eq(i+1).attr("data-topicId"),l.swipeTo(i+1),n.eq(i+1).addClass("swiper-slide-active").siblings().removeClass("swiper-slide-active"),a.slidedData(t),a.relationInfo(t),d("#relation-part").getNiceScroll(0).doScrollTop(0,.01))}),n.on("click",function(){var e=d(this),t=e.attr("data-topicId"),i=e.index();l.swipeTo(t),e.addClass("swiper-slide-active").siblings().removeClass("swiper-slide-active"),a.slidedData(t),a.relationInfo(t),d("#relation-part").getNiceScroll(0).doScrollTop(0,.01),0==i?o.addClass("disable"):o.removeClass("disable"),i===r-1?s.addClass("disable"):s.removeClass("disable")})},scrollbar:function(){d("#relation-part").niceScroll({cursorcolor:"#666",cursoropacitymax:.5,touchbehavior:!1,cursorwidth:"6px",cursorborder:"0",cursorborderradius:"8px",autohidemode:!1})},getSwiperData:function(){var a=["{{#each Message}}",'<div class="item swiper-slide noSwiping" data-topicId="{{ID}}"  clickkey="topSlide|list" clickdata="{{ID}}|zhuti" clickremark="" >','<div class="link">','{{#if TopicImg}}<img src="{{TopicImg}}" /> {{else}}<img src="'+imgplaceholder+'" /> {{/if}}','<p class="title">{{TopicName}}</p>','<div class="activedSummary">{{subStrs TopicSummary 69}}</div><div class="detail">',"{{subStrs TopicSummary 35}} ",'</div><p class="ConcernIndex">关注指数','    <i class="icon-1">{{starNum ConcernIndex}}</i>',"</p>","</div>","</div>","{{/each}}"].join(""),n=this;c.registerHelper("lessWord",function(e){return e==undefined||null==e||0==e.length?e="":35<e.length?e="detail-tip":e.length<35&&(e="detail-tip less-word"),new c.SafeString(e)}),c.registerHelper("starNum",function(e){if(e==undefined||null==e||0==e.length)e="";else for(var t="",i=0;i<Math.floor(e);i++)t+="&#xe60a;";return new c.SafeString(t)}),n.dataUse={},c.registerHelper("subStrs",function(e,t){return e==undefined||null==e||0==e.length?e="":e.length>t&&(e=e.slice(0,t)+"..."),new c.SafeString(e)}),c.registerHelper("tipShowOrNot",function(e,t){return e=e==undefined||null==e||0==e.length?"":e.length>t?e:"",new c.SafeString(e)});var r=d("#slide .swiper-wrapper");d.ajax({url:window.gConfig.apiHost+"topic/GetTopicList?currpage=1&pageSize=30",contentType:"application/json",type:"GET",timeout:ajaxTimeout,dataType:"JSON",success:function(e){if(n.loadSlideData=!0,0==e.RetCode&&e.Message&&0<e.Message.length){n.dataUse={Message:[]};for(var t=0;t<e.Message.length;t++)0!=e.Message[t].ID&&n.dataUse.Message.push(e.Message[t]);var i=c.compile(a)(n.dataUse);r.find(".no-info").find(".noContent").remove(),r.html(i);for(t=0;t<n.dataUse.Message.length;t++)n.dataUse.Message[t].ID==n.topicID&&(n.topicId=t);n.topicID="0"!==n.topicID&&n.topicID?n.topicID:n.dataUse.Message[0].ID,n.topicId=n.topicId||0,n.buildThemesSwiper(),n.slidedData(n.topicID),n.relationInfo(n.topicID)}else r.html(s.nonedataHtml)},error:function(e,t,i){r.html(s.nonedataHtml),d("#relation-list,#zixun-list").html(s.nonedataHtml),d(".relation-shares .no-info").html("暂无数据显示，请稍后重试")}})},slidedData:function(e){c.registerHelper("stockpriceCheck",function(e){return e==undefined||null==e||0==e.length?e="":0==e&&(e="-"),new c.SafeString(e)});var t=["{{#each RelatedStockList}}","<tr>",'<td class="name" data-stockCode="{{StockCodeCheck StockCode}}">{{StockName}}</td>','<td class="cont" title="{{StockSummary}}">{{subStr StockSummary 8}}&nbsp;</td>',"<td>{{stockpriceCheck StockPrice}}</td>","<td>{{toFixed StockPE}}</td>","</tr>","{{/each}}"].join(""),i=["{{#each RelatedBKList}}",'<li class="item {{updowncheck this.BKF }}" data-stockCode="{{BKCodeCheck this.BKCode}}">{{this.BKName}}<span class="increase {{upOrDown this.BKF}}">{{percent this.BKF}}</span></li>',"{{/each}}",'<li class="clearfloat"></li>'].join(""),a=this;c.registerHelper("subStr",function(e,t){return e==undefined||null==e||0==e.length?e="-":e.length>t&&(e=e.slice(0,12)+"..."),new c.SafeString(e)}),c.registerHelper("percent",function(e){function t(e){return Math.round(e)===e}if(e==undefined||null==e||0==e.length)time="";else if(t(e)){if(0==e){var i=new Date,a=i.getHours(),n=i.getMinutes();9==a&&0<=n&&n<=30?e="-":e+=".00%"}}else t(e)||(e+="%");return new c.SafeString(e)}),c.registerHelper("updowncheck",function(e){return 0<e?"little-red":e<0?"little-blue":"little-gray"}),c.registerHelper("upOrDown",function(e){return 0<e?"up":e<0?"down":""}),c.registerHelper("toFixed",function(e){return e=e==undefined||null==e||""==e?"-":new Number(e).toFixed(2),new c.SafeString(e)}),c.registerHelper("BKCodeCheck",function(e){return e=e==undefined||null==e||0==e.length?"":"2"+e,new c.SafeString(e)}),c.registerHelper("StockCodeCheck",function(e){return e==undefined||null==e||0==e.length?time="":e="6"!=e[0]?"1"+e:e,new c.SafeString(e)});for(var n=c.compile(i),r=c.compile(t),s=0;s<a.dataUse.Message.length;s++)if(a.dataUse.Message[s].ID==e)var o=n(a.dataUse.Message[s]),l=r(a.dataUse.Message[s]);d("#relation-list").html(o),d(".relation-shares .no-info").remove(),d("#relationsStockList").html(l),d("#relationsStockList .con").each(function(){12<d(this).text().length&&d(this).text(d(this).text().slice(0,12)+"...")})},relationInfo:function(i){var a=["{{#each Message}}",'<div class="content-item">','<a class="desc" href="'+pagerouter.zhutiArticle+'?NewsID={{addParas NewsInformationId}}"  clickkey="relateArticleList|title" clickdata="{{NewsInformationId}}|zhuti_article" clickremark="" ><i class="icon-1">&#xe637;</i>{{ArticleTitle}}</a><span class="time">{{renderDateTime PublishTime}}</span>',"</div>","{{/each}}"].join(""),n=this;if(c.registerHelper("renderDateTime",function(e){var t;return t=e==undefined||null==e||0==e.length?"":e.slice(5,10),new c.SafeString(t)}),c.registerHelper("addParas",function(e){return e=e==undefined||null==e||0==e.length?"":e+"&TopId="+i,new c.SafeString(e)}),n.relationData[i]){var e=c.compile(a)(n.relationData[i]);d("#zixun-list").empty().append(e)}else d.ajax({url:window.gConfig.apiHost+"expertnews/gettopicnews",type:"GET",timeout:ajaxTimeout,dataType:"JSON",data:{TopicId:i},success:function(e){if(n.loadRelationInfo=!0,0==e.RetCode&&e.Message&&0<e.Message.length){n.relationData[i]=e;var t=c.compile(a)(e);d("#zixun-list").html(t)}else d("#zixun-list").html(s.nonedataHtml)},error:function(e,t,i){d("#zixun-list").html(s.nonedataHtml)}})},pageView:function(){var r;r=function(){var e,t,i,a=document.getElementsByTagName("script"),n=a[a.length-1].src.split("?"),r=2<=n.length?n[1].split("&"):undefined,s={};if(r!=undefined)for(var o=0,l=r.length;o<l;o++)t=(e=r[o].split("="))[0],i=e[1],"undefined"==typeof s[t]?s[t]=i:("string"==typeof s[t]&&(s[t]=[s[t]]),s[t].push(i));return function(){return s}}(),function(){try{var e=window.top.location.href,t=document.referrer;if(Code=r().code,app=module=remark="","undefined"!=typeof App&&(app=App),"undefined"!=typeof Module&&(module=Module),"undefined"!=typeof Remark&&(remark=Remark),Code!=undefined&&""!=Code){var i="http://aliapi.tongji.emoney.cn/Page/PageView?v="+Math.random()+"&code="+Code+"&referurl="+encodeURIComponent(t)+"&pageurl="+encodeURIComponent(e)+"&app="+app+"&module="+module+"&remark="+remark,a=document.createElement("script");a.src=i,document.body.appendChild(a)}}catch(n){}}()}};s.init(),d.emoneyAanalytics().Init(tjAppid.expert,"zhuti","")});